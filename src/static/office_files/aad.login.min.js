function pageOnReady(){try{$(".no_display").attr("aria-hidden","true"),$(".hidden").attr("aria-hidden","true")}catch(n){}$(".login_inner_container.no_display").removeClass("no_display"),$("#background_background_image").css("width","auto"),$("#background_background_image").css("height","auto"),User.RegisterOnLoadImage(),$.browser.msie&&$.browser.version.slice(0,1)=="8"?document.body.onresize=function(){User.resize_bg(),User.moveFooterToBottom()}:$(window).resize(function(){User.resize_bg(),User.moveFooterToBottom()}),$("#cred_userid_inputtext").val()!=undefined&&User.setupCredFieldsWithPlaceHolder(),Context.whr=decodeURIComponent(Util.ExtractQSParam("whr")),User.updateGuestLink(),$("#redirect_cancel_link").attr("href","javascript:Context.back_action_stack.TriggerCancelAction();"),$("#login_panel").show(),$("#login_no_script_panel").hide(),$(".login_cred_container").append($("<input/>").attr("id","home_realm_discovery").attr("type","hidden").val(Context.username_state.home_realm_state)),$("#cred_sign_in_button").click(function(){Post.SubmitCreds()}),$("#cred_sign_in_button").keydown(function(n){User.KeyPressEnter(n,Post.SubmitCreds,13)}),$(".refresh_domain_state").click(function(){User.RefreshDomainState()}),$("input[type=checkbox]").click(function(){User.RefreshDomainState()}),$("#cred_cancel_button").click(function(){if(Constants.IS_CXH_REQUEST||Constants.IS_ADAL_REQUEST&&!Constants.ADAL_UX_OVERRIDE)if(Constants.CANCEL_REDIRECT_URL)User.Redirect(decodeURIComponent(Constants.CANCEL_REDIRECT_URL));else{var n=0;Context.back_action_stack.DoesCancelActionExist()&&(n=Context.back_action_stack.pop(),Context.back_action_stack.AddAction(n)),n===Constants.CancelAction.FROM_DISAMBIGUATION_SCREEN_TO_LOGIN?Context.back_action_stack.TriggerCancelAction():event.preventDefault()}else Context.back_action_stack.TriggerCancelAction()}),$("#cred_cancel_button").keydown(function(n){User.KeyPressEnter(n,function(){$("#cred_cancel_button").click(),n.preventDefault()},13)}),$("#background_company_name_text").text(Constants.PARTNER_NAME),Constants.FEDERATION_QUERY_PARAMETERS=Constants.FEDERATION_QUERY_PARAMETERS.replace(/&username(=[^&]*)?|^username(=[^&]*)?&?/,""),Support.renderBrowserSpecific(),Support.UpdatePasswordResetLink(),Instrument.document_ready_end_time=Util.now()}var ErrorCodes,Constants,Context,Background,Logo,Instrument,User,tenant_info,EmailDiscovery,origHide,origShow,origAddClass,origRemoveClass,Support,HIP,ThirdPartyCookieStates,PostType,LoginOption,Post,ProofUp,StrongAuthCheck,TenantBranding,users,Tiles,Util,WindowsBrowserSso;MSLogin={},MSLogin.ErrorCodes={IDP_ERROR:2147776681,IDP_ERROR2:2147776682,NAMESPACE_ERROR:2147778860,PARSE_ERROR:2147762276},ErrorCodes=MSLogin.ErrorCodes,MSLogin.Constants={REDIRECT_COUNTDOWN_DEFAULT:3,FEDERATION_QUERY_PARAMETERS:"",CDN_IMAGE_PATH:"images/",LATENCY_THRESHOLD:2e3,HIP_DATA_URL:"",PREFETCH_URL:"",THREATMETRIX_URL_LOGIN:"",LATENCY_SENSITIVITY_DEFAULT:1,OTHER_ACCOUNT_TEXT:"",MAX_TILE_TEXT_LENGTH:25,PREFILL_MEMBER_NAME:"",MEMBER_NAME:"",DEFAULT_FOOTER_LINKS:{},DEFAULT_ENABLED_FOOTER_LINKS:["legal","privacy","feedback"],FOOTER_LINKS:{},REDIRECT_MESSAGES:{},HAS_SUBMITTED:!1,METRICS_MODE:1,SUBMIT_METRICS_ON_REDIRECT:!1,SUBMIT_METRICS_ON_POST:!1,MOBILE_WIDTH_THRESHOLD:600,MOBILE_HEIGHT_THRESHOLD:600,PARTNER_NAME:"",MSA_LABEL:"",FEATURE_SLOT_MASK:0,FEATURE_SLOT_THRESHOLD:2147483647,SAVED_USER_COOKIE:"MSSavedUser",PREFILL_USER_COOKIE:"MSPPre",SAVED_USER_COOKIE_INFO_DELIMITER:"$",SAVED_USER_COOKIE_USER_DELIMITER:"|",ANCHORED_FOOTER_LINKS:!1,OPTIN_FEATURE_EXPERIMENTS:null,MAX_USER_TILES:1,MSA_ENABLED:!1,DIR:"ltr",TWOFA_POLLING_INTERVAL:null,TWOFA_MAX_POLLS:null,TWOFA_MARKET:null,TWOFA_MAXMETHODS:20,TWOFA_OTP_MAX_LEN:6,TWOFA_TIMEOUT:1e4,TWOFA_ANIMATION_INTERVAL:3e3,TWOFA_AUTH_TIMEOUT:12e4,TWOFA_REMEMBER_DEVICE_ENABLED:!1,EMAIL_DISCOVERY_SERVICE_TIMEOUT:3e3,EMAIL_DISCOVERY_SERVICE_URI:"/GetUserRealmExtended.srf",EMAIL_DISCOVERY_DEFAULT_TILES:null,MSA_AUTH_URL:null,TENANT_BRANDING:null,LCID:null,MSA_ACCOUNT_IMG_ALT_TEXT:"",AAD_ACCOUNT_IMG_ALT_TEXT:"",MSA_ACCOUNT_TILE_ALT_TEXT:"",AAD_ACCOUNT_TILE_ALT_TEXT:"",HIP_IMAGE_ALT_TEXT:null,DEFAULT_ILLUSTRATION:"",DEFAULT_ILLUSTRATION_ALT:"",DEFAULT_LOGO:"",DEFAULT_LOGO_ALT:"",DEFAULT_BACKGROUND_COLOR:"#333333",GENERIC_ERROR_CODES:[ErrorCodes.IDP_ERROR,ErrorCodes.IDP_ERROR2,ErrorCodes.NAMESPACE_ERROR,ErrorCodes.PARSE_ERROR],REALM_RESOLVER_URL:"/GetUserRealm.srf",DYNAMIC_BRANDING_CTA_ENABLED:!0,DYNAMIC_BRANDING_APPROVED_BROWSERS:[["msie","8.0"],["mozilla","5.0"],["webkit","537.4"],["chrome","42"]],USERNAME_HINT_TEXT:"someone@example.com",REGEX_PHONE:/^[\+]{0,1}([\(\)\- \*\.#/\[\]]*\d[\(\)\- \*\.#/\[\]]*){4,20}$/,REGEX_EMAIL:/^([\w-\.\']+@([\w-]+\.)+[\w-]{2,46})?$/},MSLogin.Constants.State={NONE:0,FEDERATED:1,MANAGED:2,INVALID:3,PENDING:4},MSLogin.Constants.MSAccount={EXISTS:0,NOT_EXIST:1,THROTTLED:2},MSLogin.Constants.TokenizedStringMsgs={GENERIC_ERROR:"",UPN_DISAMBIGUATE_MESSAGE:""},MSLogin.Constants.NameSpaceType={UNKNOWN:"Unknown",FEDERATED:"Federated",MANAGED:"Managed"},MSLogin.Constants.FederationProtocol={SAML20:"SAML20"},MSLogin.Constants.EmailDiscoveryAccountState={AAD_UNKNOWN_AND_MSA_NOT_EXIST:0,AAD_UNKNOWN_AND_MSA_EXISTS:1,AAD_UNKNOWN_AND_MSA_THROTTLED:2,AAD_UNKNOWN_AND_MSA_TIMED_OUT:3,AAD_FEDERATED_AND_MSA_NOT_EXIST:4,AAD_FEDERATED_AND_MSA_EXISTS:5,AAD_FEDERATED_AND_MSA_THROTTLED:6,AAD_FEDERATED_AND_MSA_TIMED_OUT:7,AAD_MANAGED_AND_MSA_NOT_EXIST:8,AAD_MANAGED_AND_MSA_EXISTS:9,AAD_MANAGED_AND_MSA_THROTTLED:10,AAD_MANAGED_AND_MSA_TIMED_OUT:11,AAD_TIMED_OUT_AND_MSA_NOT_EXIST:12,AAD_TIMED_OUT_AND_MSA_EXISTS:13,AAD_TIMED_OUT_AND_MSA_THROTTLED:14,AAD_TIMED_OUT_AND_MSA_TIMED_OUT:15,ERROR:16},MSLogin.Constants.CancelAction={FROM_REDIRECT_TO_LOGIN:0,FROM_SHOW_USER_TO_TILES:1,FROM_MANY_TO_EMAILDISCOVERY_INIT:2,FROM_EMAILDISCOVERY_START_TO_TILES:3,FROM_EMAILDISCOVERY_SPLITTER_TO_EMAILDISCOVERY_START:4,FROM_EMAILDISCOVERY_AAD_LOGIN_TO_EMAILDISCOVERY_START:5,FROM_EMAILDISCOVERY_AAD_LOGIN_TO_EMAILDISCOVERY_SPLITTER:6,FROM_EMAILDISCOVERY_LOOKING_FOR_ACCOUNT_TO_EMAILDISCOVERY_START:7,FROM_EMAILDISCOVERY_REDIRECT_TO_EMAILDISCOVERY_START:8,FROM_EMAILDISCOVERY_REDIRECT_TO_EMAILDISCOVERY_SPLITTER:9,FROM_EMAILDISCOVERY_SPLITTER_FALLBACK_TO_TILES:10,FROM_DISAMBIGUATION_SCREEN_TO_LOGIN:11},MSLogin.Constants.AuthNForwardType={NORMAL:0,MULTIAUTH_ADFS:1,NON_MULTIAUTH_ADFS:2,WIAORMULTIAUTHN_ADFS:3},MSLogin.BackActionStack=function(){this.BackActionStack=[]},MSLogin.BackActionStack.prototype.AddAction=function(n){this.BackActionStack.push(n)},MSLogin.BackActionStack.prototype.TriggerCancelAction=function(){Context.post_from_tile=!1;var n=this.BackActionStack.pop();switch(n){case Constants.CancelAction.FROM_REDIRECT_TO_LOGIN:User.CancelRedirect();break;case Constants.CancelAction.FROM_SHOW_USER_TO_TILES:TenantBranding.RestoreDefaultPageBranding(),Tiles.CancelTileRedirect();break;case Constants.CancelAction.FROM_MANY_TO_EMAILDISCOVERY_INIT:EmailDiscovery.Init();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_START_TO_TILES:EmailDiscovery.BackToUserTiles();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_TO_EMAILDISCOVERY_START:Context.username_state.last_checked_email="",EmailDiscovery.HideSplitter(),EmailDiscovery.ShowEmailDiscovery();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_AAD_LOGIN_TO_EMAILDISCOVERY_START:Context.username_state.last_checked_email="",EmailDiscovery.HideAADLoginLayout(),EmailDiscovery.ShowEmailDiscovery();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_AAD_LOGIN_TO_EMAILDISCOVERY_SPLITTER:EmailDiscovery.HideAADLoginLayout(),Context.email_discovery_use_msa_api?this.TriggerCancelAction():EmailDiscovery.ShowSplitter();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_LOOKING_FOR_ACCOUNT_TO_EMAILDISCOVERY_START:Context.username_state.last_checked_email="",EmailDiscovery.CancelLookingForAccount();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_REDIRECT_TO_EMAILDISCOVERY_START:Context.username_state.last_checked_email="",EmailDiscovery.CancelRedirect(),EmailDiscovery.ShowEmailDiscovery();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_REDIRECT_TO_EMAILDISCOVERY_SPLITTER:EmailDiscovery.CancelRedirect(),Context.email_discovery_use_msa_api?this.TriggerCancelAction():EmailDiscovery.ShowSplitter();break;case Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_FALLBACK_TO_TILES:EmailDiscovery.HideSplitter(),this.TriggerCancelAction();break;case Constants.CancelAction.FROM_DISAMBIGUATION_SCREEN_TO_LOGIN:Context.username_state.last_checked_email="",Tiles.hideDisambiguationScreen(),Tiles.showUserLoginPage()}},MSLogin.Store=function(){this.Map={}},MSLogin.Store.prototype.Get=function(n){var t=$.trim(n).toLowerCase();return this.Map[t]},MSLogin.Store.prototype.Add=function(n,t){var i=$.trim(n).toLowerCase();this.Map[i]=t},MSLogin.BackActionStack.prototype.RemoveLastCancelAction=function(){this.BackActionStack.pop()},MSLogin.BackActionStack.prototype.DoesCancelActionExist=function(){return this.BackActionStack.length>0},MSLogin.BackActionStack.prototype.ClearCancelActions=function(){this.BackActionStack=[]},Constants=MSLogin.Constants,MSLogin.Context={whr:"",use_instrumentation:!1,query_search_params:document.location.search,federated_domain:"",redirect_countdown:Constants.REDIRECT_COUNTDOWN_DEFAULT,redirect_auth_url:"",redirect_target:"",animationTid:null,redirectTid:null,metrics_on_redirect_submitted:!1,cobranding_image_visible:!1,prefetch_initiated:!1,user_tiles:null,email_discovery_lookup_xhr:null,email_discovery_mode:!1,email_discovery_tiles_mode:!1,email_discovery_response:null,email_discovery_timeout_occurred:!1,email_discovery_splitter_shown:!1,email_discovery_workflow_state:0,email_discovery_easi_user:!1,email_discovery_use_msa_api:!0,cred_height:-1,has_forced_cred_block_height:!1,original_orientation:window.orientation,back_action_stack:new MSLogin.BackActionStack,tenant_branding_tid:null,tenant_branding_retry_count:2e3,tenant_branding_polling_interval:20,tenant_branding_ts:0,authn_forward_state:0,post_from_tile:!1,on_load_image_background_loaded:!1,password_reset_link_url:"",redirect_to_manage:!1,getuserrealmresult:null},MSLogin.Context.username_state={is_empty:!0,is_partial:!1,is_timeout:!1,home_realm_state:0,disable_password:!0,enable_guests:!0,enable_redirect:!1,enable_progress_bar:!1,last_checked_email:""},MSLogin.Context.TenantBranding={key:null,user:null,prev_key:null,prev_obj:null,prev_user:null,prev_boiler_plate_height:0,default_page:!1,whr_key:null,applied:!1,info:null,info_context:null,enabled:!1,has_logo:!1,has_background_img:!1,background_color:Constants.DEFAULT_BACKGROUND_COLOR,footer_height:0,footer_height_saved:!1,cred_height:0,cred_height_saved:!1,workload_branding_saved:!1,workload_branding_illustration:null,workload_branding_illustration_alt:null,workload_branding_logo:null,workload_branding_logo_alt:null,workload_branding_footer_height:0,workload_branding_footer_height_saved:!1,workload_branding_color:null,workload_branding_height:0,workload_branding_enabled:!1,workload_branding_login_cta_text:"",store:new MSLogin.Store,browser_supports_dynamic:!1,browser_supports_dynamic_checked:!1,kmsi_checkbox_hidden:!1,username_hint_changed:!1},Context=MSLogin.Context,MSLogin.Background={delayed_background_fetch_url:"",background_image_ratio:0,background_image_loaded:!1,background_image_wait:null,winW:-1,winH:460,viewport_height:460,alt_image_path:"",alt_background_path:"",background_resized:!1},Background=MSLogin.Background,MSLogin.Logo={logo_image_loaded:!1,logo_image_wait:null,winW:-1,winH:159,alt_image_path:"",alt_logo_path:""},Logo=MSLogin.Logo,MSLogin.Instrument={latency_sensitivity:Constants.LATENCY_SENSITIVITY_DEFAULT,home_realm_start:null,home_realm_load_time:0,prefetch_done:!1,prefetch_start:null,prefetch_load_time:0,background_image_loaded:!1,background_image_start:null,background_image_load_time:0,background_image_error:!1,logo_image_loaded:!1,logo_image_start:null,logo_image_load_time:0,logo_image_error:null,email_discovery_ui_code:0,email_discovery_splitter_choice:0,possible_easi_user:0,tenant_branding_start_time:(new Date).getTime(),tenant_branding_process_end_time:0,tenant_branding_json_end_time:0,tenant_branding_load_error:!1,has_tenant_branding:!1,has_dynamic_tenant_branding:!1,tenant_branding_total_time:0,tenant_branding_number_of_switches:0,tenant_branding_right_side_time:0,logo_image_end_time:0,background_image_end_time:0,document_ready_end_time:0,document_load_end_time:0},Instrument=MSLogin.Instrument,MSLogin.User={UpdateUsernameState:function(){var n=$.trim($("#cred_userid_inputtext").val()),t,i;$("input#cred_userid_inputtext").val(n),Context.username_state.is_empty=!1,Context.username_state.is_partial=!1,n!=Context.username_state.last_checked_email&&(Context.username_state.home_realm_state=Constants.State.NONE),n==""&&(Context.username_state.is_empty=!0,Context.username_state.is_partial=!0,Context.username_state.is_timeout=!1,Context.username_state.disable_password=!0,Context.username_state.enable_redirect=!1,Context.username_state.home_realm_state=Constants.State.NONE),Support.validateUsernameCredInput(n)||(Constants.IS_MSA_PHONE_USERNAME_SUPPORTED&&Constants.REGEX_PHONE.test(n)?(Context.username_state.is_empty=!1,Context.username_state.is_partial=!1,Context.username_state.home_realm_state=Constants.State.NONE):(t=decodeURIComponent(Util.ExtractQSParam("nca")),Context.username_state.is_empty=!1,Context.username_state.is_partial=!0,Context.username_state.home_realm_state=Constants.State.NONE,t=="true"||t=="1"||Constants.IS_NAME_COEXISTENCE_ACCOUNT||(i=30064,n!=null&&n.indexOf("\\")>-1&&(i=30066),Support.showClientError(i)))),Context.username_state.is_timeout&&(Context.username_state.is_timeout=!0,Context.username_state.disable_password=!1,Context.username_state.enable_redirect=!1);switch(Context.username_state.home_realm_state){case Constants.State.FEDERATED:Context.username_state.is_timeout=!1,Context.username_state.disable_password=!0,Context.username_state.enable_redirect=!0;break;case Constants.State.MANAGED:Context.username_state.is_timeout=!1,Context.username_state.disable_password=!1,Context.username_state.enable_redirect=!1;break;case Constants.State.INVALID:Context.username_state.is_timeout=!1,Context.username_state.disable_password=!0,Context.username_state.enable_redirect=!1;break;default:Context.username_state.is_timeout=!1,Context.username_state.disable_password=!0,Context.username_state.enable_redirect=!1}$("#home_realm_discovery").val(Context.username_state.home_realm_state)},IsGuestUser:function(){var n=window.location.href;return n!=null&&(Context.query_search_params.indexOf("guests=1")>-1||Context.query_search_params.indexOf("guest=1")>-1)?!0:!1},UsernameOnChangeHandler:function(){User.UpdateUsernameState(),$("#recover_container").removeClass("hidden"),$("#recover_container").css("opacity",1),Context.username_state.disable_password?$("#cred_sign_in_button").addClass("disabled_button"):$("#cred_sign_in_button").removeClass("disabled_button"),Context.username_state.enable_redirect?($("#cred_password_container").css("opacity",0),$("#cred_password_container").addClass("hidden"),$("#redirect_message_container").removeClass("no_display"),$("#redirect_message_container").css("opacity",1),$("#redirect_message_container").removeClass("hidden"),$(".login_guest_container").css("opacity",0),$("#cred_sign_in_button").css("opacity",0),$("#cred_sign_in_button").addClass("hidden")):($("#cred_password_container").removeClass("hidden"),$("#cred_password_container").css("opacity",1),$("#redirect_message_container").css("opacity",0),$("#redirect_message_container").addClass("hidden"),$("#redirect_message_container").addClass("no_display"),$(".login_guest_container").css("opacity",1),$("#cred_sign_in_button").css("opacity",1),$("#cred_sign_in_button").removeClass("hidden")),Context.username_state.enable_guests&&User.IsGuestUser()?($("#guest_hint_text").show(),$("#alternative-identity-providers").hide(),$(".guest_redirect_container").show()):($("#guest_hint_text").hide(),$(".guest_redirect_container").hide()),Context.username_state.enable_progress_bar||(clearInterval(Context.animationTid),$("div.progress").css("visibility","hidden"))},setupPrefetching:function(){if(!Context.prefetch_initiated&&Support.is_prefetch_supported()&&(Constants.PREFETCH_URL!=""&&User.latencySensitivity()>=-1&&(Instrument.prefetch_start=Util.now(),Util.PrefetchContent(Constants.PREFETCH_URL),Context.prefetch_initiated=!0),Constants.THREATMETRIX_URL_LOGIN!=""&&User.latencySensitivity()>=-1)){var n=Constants.THREATMETRIX_URL_LOGIN;Constants.THREATMETRIX_URL_LOGIN="",Util.PrefetchThreatMetrixContent(n)}},onLoadImage:function(){var n=$("#background_background_image");Background.background_image_ratio=Support.isDefined(n)&&Support.isDefined(n[0])&&Support.isDefined(n[0].naturalWidth)&&Support.isDefined(n[0].naturalHeight)&&n[0].naturalHeight!=0?n[0].naturalWidth/n[0].naturalHeight:n.width()/n.height(),Background.background_image_loaded=!0,Util.debug_console("OnLoadImage: Called"),Background.background_resized&&!Context.on_load_image_background_loaded&&User.IsImageLoaded(n)&&(Context.on_load_image_background_loaded=!0,TenantBranding.IsShowingDynamicBranding()?Logo.logo_image_loaded&&TenantBranding.onLoadImageHelper():User.onLoadImageHelper())},onLoadImageHelper:function(){var n=$("#background_background_image"),t;n.hide(),$("#background_background_image_old").remove(),$("#background_page_overlay").css("visibility","visible"),n.show(),t=$("html").css("background-color"),$("#background_page_overlay").css("background-color",t),$("#background_page_overlay").show(),$("#background_page_overlay").fadeOut(500,"linear"),Util.debug_console("OnLoadImage: Background was resized.")},updateGuestLink:function(){var n=$("#guest_redirect_link").attr("href");n!=""&&n!=undefined&&(n=User.addFederatedRedirectQSParameters(n),$("#guest_redirect_link").attr("href",n))},setupCredValidation:function(){$("#credentials").validate({errorLabelContainer:"#cta_error_message_text",wrapper:"li",submitHandler:function(n){$("#cred_password_inputtext").focus(),n.submit()},showErrors:function(n,t){t.length>0&&($("#cta_error_message_text").html(""),$("#cta_error_message_text").html(t[0].message));try{n.user_id&&(Context.username_state.is_partial=!0,Context.username_state.disable_password=!0,Context.username_state.home_realm_state=Constants.State.NONE,$("#cred_password_inputtext").blur(),$("#cred_userid_inputtext").focus(),User.UsernameOnChangeHandler())}catch(i){}}})},forceOrientationResize:function(){Context.original_orientation=-1,User.resize_bg(Context.original_orientation)},setupCredFieldsWithPlaceHolder:function(){var n=$("input#cred_userid_inputtext"),t=$("input#cred_password_inputtext"),i,r,u;n.focus(function(){Context.username_state.enable_redirect&&User.CancelRedirect()}),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&n.blur(function(){User.forceOrientationResize()}),n.change(function(){User.RefreshDomainState(),User.UsernameOnChangeHandler()}),n.keydown(function(n){User.KeyPressEnter(n,User.RefreshDomainState,13),Context.email_discovery_workflow_state!=EmailDiscovery.WorkflowStates.INIT&&User.KeyPressEnter(n,User.RefreshDomainState,9)}),t.keypress(function(n){User.KeyPressEnter(n,Post.SubmitCreds,13)}),$("input#cred_keep_me_signed_in_checkbox").keypress(function(n){User.KeyPressEnter(n,Post.SubmitCreds,13)}),$("input#cred_keep_me_signed_in_checkbox").change(function(){User.updateGuestLink()}),t.click(function(){User.UsernameOnChangeHandler(),Context.username_state.is_empty||Context.username_state.is_partial||User.RefreshDomainState()}),t.blur(function(){User.forceOrientationResize()}),Util.debug_console("placeholder supported: "+Support.is_placeholder_supported()),Support.is_placeholder_supported()||($("input[placeholder]").each(function(){var r=$(this).attr("placeholder"),t=$(this).attr("id"),i="",n;t&&(i='id="'+t+'_placeholder_span"'),n=$('<span class="placeholder" '+i+">"+r+"<\/span>").appendTo($(this).parent()),$(this).before(n),n.css("position","absolute"),n.css("display","block"),n.addClass("normaltext"),n.click(function(){$(this).siblings("input").focus()}),$(this).attr("placeholder"," ")}),$("input[placeholder]").focus(function(){$(this).val()==""?($(this).css("background","transparent"),$(this).siblings(".placeholder").css("filter","alpha(opacity=100)"),$(this).siblings(".placeholder").css("visibility","visible")):($(this).css("background","#FFFFFF"),$(this).siblings(".placeholder").css("filter","alpha(opacity=0)"),$(this).siblings(".placeholder").css("visibility","hidden"))}),$("input[placeholder]").keydown(function(){$(this).css("background","#FFFFFF"),$(this).siblings(".placeholder").css("filter","alpha(opacity=100)"),$(this).siblings(".placeholder").css("visibility","hidden")}),$("input[placeholder]").bind("paste",function(){$(this).css("background","#FFFFFF"),$(this).siblings(".placeholder").css("filter","alpha(opacity=100)"),$(this).siblings(".placeholder").css("visibility","hidden")}),$("input[placeholder]").keyup(function(){$(this).val()==""?($(this).css("background","transparent"),$(this).siblings(".placeholder").css("filter","alpha(opacity=0)"),$(this).siblings(".placeholder").css("visibility","visible")):($(this).css("background","#FFFFFF"),$(this).siblings(".placeholder").css("filter","alpha(opacity=0)"),$(this).siblings(".placeholder").css("visibility","hidden"))}),$("input[placeholder]").blur(function(){$(this).val()==""?($(this).css("background","transparent"),$(this).siblings(".placeholder").css("filter","alpha(opacity=100)"),$(this).siblings(".placeholder").css("visibility","visible")):($(this).css("background","#FFFFFF"),$(this).siblings(".placeholder").css("filter","alpha(opacity=0)"),$(this).siblings(".placeholder").css("visibility","hidden"))}),t.parent().click(function(){User.UsernameOnChangeHandler(),Context.username_state.is_empty||Context.username_state.is_partial||User.RefreshDomainState()})),i=decodeURIComponent(Util.ExtractQSParam("username")),r=$("#cred_userid_inputtext").val(),i!=""&&(u=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,46})?$/,u.test(i)&&r==""&&$("#cred_userid_inputtext").val(i)),$("#redirect_cta_text").hide()},setupCallToActionMessages:function(){$.each(Constants.GENERIC_ERROR_CODES,function(n,t){$("#cta_client_error_text").append($("<div/>").addClass("client_error_msg").addClass(t.toString()).html(Constants.TokenizedStringMsgs.GENERIC_ERROR.replace("#~#ErrorCode#~#",t)))})},resize_bg:function(n){var u,r;if((n!=undefined&&(Context.original_orientation=n),document.body&&document.body.offsetWidth&&(Background.winW=document.body.offsetWidth,Background.winH=document.body.offsetHeigh),document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth&&(Background.winW=document.documentElement.offsetWidth,Background.winH=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(Background.winW=window.innerWidth,Background.winH=window.innerHeight),u=document.documentMode,Support.isDefined(document.documentElement)&&Support.isDefined(document.documentElement.clientHeight)&&(Background.viewport_height=document.documentElement.clientHeight),$.browser.msie&&u>=10&&(navigator.userAgent.match(/IEMobile/)&&Background.viewport_height>10?$("td#login_panel_center").css("height",Background.viewport_height-10):$("td#login_panel_center").css("height",Background.winH-10)),Support.renderForVirtualKeyboard(),Background.background_image_loaded||Background.delayed_background_fetch_url!=null)&&(!Background.background_resized||typeof window.orientation=="undefined"||Context.original_orientation!=window.orientation)&&(Context.original_orientation=window.orientation,!Support.isUXFeatureEnabled(512)||Util.ExtractQSParam("popupui")!="1")){if(Support.showIllustration()&&Background.delayed_background_fetch_url!=null&&($("#background_background_image").error(function(){Instrument.tenant_branding_load_error=!0}),User.UpdateBackground(Background.delayed_background_fetch_url,$("html").css("background-color"))),Util.debug_console("resize_bg Background: "+Background.winW+" x "+Background.winH),r=Support.getViewport(),Util.debug_console("resize_bg Viewport: "+r[0]+" x "+r[1]),Util.debug_console("resize_bg JQuery: "+$("body").width()+" x "+$("body").height()),$("img#background_background_image").error(function(){$(this).hide()}),!Background.background_image_loaded||Background.background_image_ratio==0){Util.debug_console("Background image not yet loaded.");return}var e=$(document).width()-400,f=$(document).height(),i=e,t=Math.round(i/Background.background_image_ratio);$("#background_background_image").width(i),$("#background_background_image").height(t),t<f&&(t=f,i=Math.round(t*Background.background_image_ratio),$("#background_background_image").width(i),$("#background_background_image").height(t)),Background.background_image_loaded&&!Background.background_resized&&(Util.debug_console("Background image loaded!"),Background.background_resized=!0,User.onLoadImage()),Util.debug_console("bg_image: "+i+" x "+t)}},getElementHeightSpacing:function(n,t){var i=0;return i+=$(n).height(),t&&(i+=parseInt($(n).css("padding-top")),i+=parseInt($(n).css("padding-bottom"))),i},getElementHeightMargin:function(n){return 0+parseInt($(n).css("margin-top"))+parseInt($(n).css("margin-bottom"))},doesElementExist:function(n){return $(n).height()!=null},moveFooterToBottom:function(){},latencySensitivity:function(){var n=Constants.LATENCY_SENSITIVITY_DEFAULT,t=Util.ExtractQSParam("bandwidth"),i;Support.isUXFeatureEnabled(16)&&(i=performance.timing,i.responseEnd-i.fetchStart>Constants.LATENCY_THRESHOLD&&(t="low")),Support.isUXFeatureEnabled(8)&&(t="low");switch(t){case"low":n=-1;break;case"high":n=1;break;case"critical":n=-2}return Instrument.latency_sensitivity=n,n},updateClientMetricsMode:function(){switch(Constants.METRICS_MODE){case 0:Constants.SUBMIT_METRICS_ON_REDIRECT=!1,Constants.SUBMIT_METRICS_ON_POST=!1;break;case 1:Constants.SUBMIT_METRICS_ON_REDIRECT=!1,Constants.SUBMIT_METRICS_ON_POST=!0;break;case 2:Constants.SUBMIT_METRICS_ON_REDIRECT=!0,Constants.SUBMIT_METRICS_ON_POST=!1;break;case 3:Constants.SUBMIT_METRICS_ON_REDIRECT=!0,Constants.SUBMIT_METRICS_ON_POST=!0;break;default:Constants.SUBMIT_METRICS_ON_REDIRECT=!1,Constants.SUBMIT_METRICS_ON_POST=!1}},GetHashedImagePath:function(n){return n},UpdateBackground:function(n,t){if((t==null||t==""||Constants.IS_CXH_REQUEST)&&(t=$("html").css("background-color")),TenantBranding.IsShowingDynamicBranding()?Context.TenantBranding.background_color=t:($("#background_page_overlay").css("background-color",t),$("#background_background_image").css("background-color",t),$("#background_branding_container").css("background-color",t),$("html").css("background-color",t)),Background.winW<Constants.MOBILE_WIDTH_THRESHOLD){Util.debug_console("Screen size too small to fetch background."),Background.delayed_background_fetch_url=n;return}if($("#background_background_image").error(function(){$(this).show(),Context.TenantBranding.has_background_img=!1,TenantBranding.IsShowingDynamicBranding()&&Logo.logo_image_loaded&&TenantBranding.onLoadImageHelper()}),User.onLoadImage(),Background.delayed_background_fetch_url=null,!Support.showIllustration()||n==""||User.latencySensitivity()<0)Util.debug_console("Image load was cancelled."),$("#background_background_image").css("visibility","hidden"),Support.isUXFeatureEnabled(8)||Support.isUXFeatureEnabled(16)?($("#background_company_name_text").css("opacity",1),Support.isUXFeatureEnabled(16)&&n!=""&&$("#auto_low_bandwidth_background_notification").css("visibility","visible")):$("#background_company_name_text").css("opacity",0),Context.on_load_image_background_loaded=!0,Background.background_resized=!1,TenantBranding.IsShowingDynamicBranding()&&Logo.logo_image_loaded&&TenantBranding.onLoadImageHelper(),setTimeout(function(){User.setupPrefetching()},1e3);else{var i=User.GetHashedImagePath(n);Context.on_load_image_background_loaded=!1,Background.background_resized=!1,Context.TenantBranding.has_background_img=!0,$("img#background_background_image").attr("src",i),$("img#background_background_image").css("visibility","visible"),$("#background_company_name_text").css("opacity",0),alt_background_image=n,Util.debug_console("Set background image: "+n),Instrument.background_image_start=Util.now()}Background.background_image_ratio=0,Util.debug_console("Fetched background image.")},UpdateLogo:function(n,t){var r,i;n==""&&$(".login_workload_logo_container").html(""),Logo.logo_image_loaded=!1,$(".workload_img").remove(),r=User.GetHashedImagePath(n),n==""?(Constants.IS_CXH_REQUEST||$(".login_workload_logo_container").append($("<h1/>").attr("id","login_workload_logo_text").css("visibility","visible").addClass("workload_img_text").addClass("gianttext").html(t)),Context.TenantBranding.has_logo=!1,TenantBranding.IsShowingDynamicBranding()?TenantBranding.onLoadLogoHelper():TenantBranding.setUserIdHintAndKmsi(),Util.debug_console("Set logo image failover.")):(i=$("<img/>"),Instrument.logo_image_start=Util.now(),TenantBranding.IsShowingDynamicBranding()?(Context.TenantBranding.has_logo=!0,i.load(function(){TenantBranding.onLoadLogo()}),i.hide()):(i.css("visibility","visible"),i.load(function(){Instrument.logo_image_end_time=Util.now()}),TenantBranding.setUserIdHintAndKmsi()),i.error(function(){TenantBranding.onLoadErrorLogo()}),i.attr("id","login_workload_logo_image").addClass("workload_img").attr("alt",Constants.PARTNER_NAME),$(".login_workload_logo_container").append(i),i=$(".workload_img"),i.attr("src",r),$("#login_workload_logo_text").remove(),alt_logo_image=n,Util.debug_console("Set logo image: "+n))},RefreshDomainState:function(){var n=!1,t=$.trim($("#cred_userid_inputtext").val());return(User.UpdateUsernameState(),Support.UpdatePasswordResetLink(),$("meta[name=PageID]").attr("content")==="strongauthcheck.2.0"||$("meta[name=PageID]").attr("content")==="proofup.2.0"||$("meta[name=PageID]").attr("content")==="i5028.2.0")?!1:(Context.username_state.is_empty||Context.username_state.is_partial?n=!1:t!==Context.username_state.last_checked_email&&(n=!0),n?User.CheckUser():TenantBranding.RefreshDomainState(t),n)},CheckUser:function(){var n=decodeURIComponent(Util.ExtractQSParam("nca"));n=="true"||n=="1"||Constants.IS_NAME_COEXISTENCE_ACCOUNT||(EmailDiscovery.ShouldPerformDiscovery()?EmailDiscovery.PerformEmailBasedDiscovery():User.PerformHomeRealmDiscovery())},PerformHomeRealmDiscovery:function(){if(Context.username_state.home_realm_state!=Constants.State.PENDING){var n=$.trim($("input#cred_userid_inputtext").val());Constants.REGEX_PHONE.test(n)&&(n=n.replace(/\D/g,"")),$("div.progress").css("visibility","visible"),User.startAnimation(),Context.animationTid=setInterval(User.startAnimation,3500),Context.username_state.enable_progress_bar=!0,$.ajax({headers:{Accept:"application/json"},url:Constants.REALM_RESOLVER_URL+encodeURI("?user="+n),dataType:"json",data:{"api-version":"2.1",stsRequest:Constants.CONTEXT,checkForMicrosoftAccount:!0},beforeSend:function(){Instrument.home_realm_start=Util.now()},success:User.ReceiveTenantInfo,error:User.ReceivedHomeRealmError}),Context.username_state.home_realm_state=Constants.State.PENDING,Context.username_state.last_checked_email=n,User.resize_bg()}},showGenericError:function(n){Support.hideClientErrorMessages(),Support.hideClientMessages(),Support.showClientError(n)},ReceivedHomeRealmError:function(n,t){$("div.progress").css("visibility","hidden"),$("input#cred_password_inputtext").focus(),Util.debug_console("Received home realm error"),Context.username_state.home_realm_state=Constants.State.NONE,clearInterval(Context.animationTid),Context.username_state.home_realm_state=Constants.State.NONE,User.UsernameOnChangeHandler(),t=="parsererror"&&User.showGenericError(ErrorCodes.PARSE_ERROR)},ReceiveTenantCustom:function(n){tenant_info.background_color=n.BackgroundColor,tenant_info.background_url=n.BackgroundPath,tenant_info.logo_url=n.LogoPath,tenant_info.boilerplate1=n.BoilerPlate1,tenant_info.boilerplate2=n.BoilerPlate2,tenant_info.cta1=n.CTA1,tenant_info.cta2=n.CTA2,Util.debug_console(n.LogoPath),clearInterval(Context.animationTid),Context.username_state.home_realm_state=Constants.State.MANAGED,User.UsernameOnChangeHandler(),$("#cred_userid_inputtext").blur(),$("#cred_password_inputtext").focus(),setTimeout(User.resize_bg,300)},ReceivedTenantError:function(){Util.debug_console("Received tenant error.")},KeyPressEnter:function(n,t,i){var r;return n&&n.which?r=n.which:window.event&&(n=window.event,r=n.keyCode),r===i&&t(),r},StartRedirection:function(n){if(Context.redirect_countdown=Constants.REDIRECT_COUNTDOWN_DEFAULT,!n||$("#cred_userid_container").css("display")!="none")return $("#cred_userid_container").css("display")==undefined?void 0:(Support.isUXFeatureEnabled(4096)&&($("meta[name=PageID]").attr("content")=="EmailBasedDiscovery.2.0"||$("meta[name=PageID]").attr("content")=="EmailBasedDiscoveryTiles.2.0")&&($("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),EmailDiscovery.is_enabled_workflow=!0),$("#cred_cancel_button").hide(),Context.username_state.enable_progress_bar=!0,Context.username_state.enable_redirect=!0,Context.username_state.enable_guests=!1,cancel_redirect=!1,$("#cred_password_container").css("opacity",0),User.UsernameOnChangeHandler(),Context.redirectTid=setTimeout("User.ShowRedirect('"+Context.federated_domain+"');$('a#redirect_cancel_link').focus();",100),Constants.IS_CXH_REQUEST||Constants.IS_ADAL_REQUEST||$("#cred_sign_in_button").hide(),Context.redirectTid)},ReceiveTenantInfo:function(n){$(".30065,.30068").is(":visible")&&(Support.hideClientError(30065),Support.hideClientError(30068));var t=!0;if(Instrument.home_realm_load_time=Util.now()-Instrument.home_realm_start,Context.username_state.enable_progress_bar=!1,Context.username_state.disable_password=!1,Context.username_state.last_checked_email=n.Login,Constants.SPLIT_VIEW_ENABLED==!0&&Constants.IS_MSA_SUPPORTED==!0&&Constants.HAS_ERROR!==!0&&n.MicrosoftAccount==0&&n.DomainName!==Context.whr)if(n.NameSpaceType!=Constants.NameSpaceType.MANAGED&&(n.NameSpaceType!=Constants.NameSpaceType.FEDERATED||Util.isMSA(n.AuthURL)))n.NameSpaceType==Constants.NameSpaceType.UNKNOWN&&MSLogin.SplitterControl.LoginMSA();else{Context.getuserrealmresult=n,Context.back_action_stack.AddAction(Constants.CancelAction.FROM_DISAMBIGUATION_SCREEN_TO_LOGIN),MSLogin.SplitterControl.Render();return}n.NameSpaceType==Constants.NameSpaceType.FEDERATED?n.federation_protocol==Constants.FederationProtocol.SAML20&&n.federation_saml_request!=null?t=MSLogin.User.PostToSamlIdp(n):(Context.back_action_stack.AddAction(Constants.CancelAction.FROM_REDIRECT_TO_LOGIN),t=MSLogin.User.ReceiveFederatedDomain(n)):t=n.NameSpaceType==Constants.NameSpaceType.MANAGED?MSLogin.User.ReceiveManagedDomain(n):MSLogin.User.ReceiveUnknownDomain(n),t&&($("#cred_userid_inputtext").blur(),$("#cred_password_inputtext").focus())},ReceiveUnknownDomain:function(n){if(n.State==1&&!n.FederationGlobalVersion)return Context.username_state.home_realm_state=Constants.State.INVALID,User.UsernameOnChangeHandler(),Util.debug_console("federationGlobalVersion bad"),$("#cred_password_inputtext").blur(),$("#cred_userid_inputtext").focus(),!1;var t=!0;return t=!Support.showClientError(n.ConsumerDomain?30065:30068),Context.username_state.home_realm_state=Constants.State.INVALID,clearInterval(Context.animationTid),User.UsernameOnChangeHandler(),Util.debug_console("Unknown home realm reply"),$("input#cred_password_inputtext").focus(),t},ReceiveFederatedDomain:function(n){return(Context.username_state.home_realm_state=Constants.State.FEDERATED,tenant_info.company_name="",tenant_info.domain=n.DomainName,Context.authn_forward_state=n.AuthNForwardType,n.DomainName.areEqualIgnoreCase(Constants.MSA_DOMAIN)&&!Constants.IS_MSA_SUPPORTED)?($(".pip").stop(!0,!0),$(".pip").hide(),clearInterval(Context.animationTid),Context.username_state.enable_redirect=!1,Context.username_state.home_realm_state=Constants.State.INVALID,Context.back_action_stack.RemoveLastCancelAction(),Support.showClientError(30065),!1):n.DomainName==Context.whr&&!User.IsGuestUser()?(Context.username_state.home_realm_state=Constants.State.MANAGED,Util.debug_console("whr set already"),User.UsernameOnChangeHandler(),$("#cred_userid_inputtext").blur(),$("#cred_password_inputtext").focus(),!1):(Context.federated_domain=n.DomainName,Context.redirect_auth_url=n.AuthURL,Context.redirect_target=User.addFederatedRedirectQSParameters(n.AuthURL),Context.back_action_stack.AddAction(Constants.CancelAction.FROM_SHOW_USER_TO_TILES),Util.updateRedirectionMessage(n.AuthURL),n.federation_protocol==Constants.FederationProtocol.SAML20&&n.federation_saml_request!=null)?(MSLogin.User.PostToSamlIdp(n),!1):(n.FederationGlobalVersion==1&&User.Redirect(Context.redirect_target),User.StartRedirection(!1),!1)},ReceiveManagedDomain:function(n){return Context.whr=n.DomainName!=undefined?n.DomainName:n.Login.split("@@")[1],n.TenantBrandingInfo!=null&&TenantBranding.StoreBrandingInfo(n.DomainName,n.TenantBrandingInfo),TenantBranding.PerformDynamicBranding(n.DomainName),Context.TenantBranding.user=n.Login,Context.username_state.home_realm_state=Constants.State.MANAGED,tenant_info.company_name=n.FederationBrandName,tenant_info.domain=n.DomainName,tenant_info.BackgroundColor=$("#background_branding_container").css("background"),tenant_info.BackgroundPath=$("#background_background_image").attr("src"),tenant_info.LogoPath=$("#login_workload_logo_image").attr("src"),tenant_info.BoilerPlate1="",tenant_info.BoilerPlate2="",tenant_info.CTA1=$("#login_cta_text").text(),tenant_info.CTA2="",tenant_info.HadBoilerPlate=!1,Context.username_state.disable_password=!1,Context.username_state.enable_progress_bar=!1,Context.username_state.enable_redirect=!1,User.UsernameOnChangeHandler(),!0},PostToSamlIdp:function(n){Context.federated_domain=n.DomainName,Context.redirect_auth_url=n.AuthURL;var t=Constants.FEDERATION_QUERY_PARAMETERS.qs("wctx");$("#samlform").attr("action",n.AuthURL),$("#samlrelaystate").val(decodeURIComponent(t)),$("#samlrequest").val(decodeURIComponent(n.federation_saml_request)),$("#samlform").submit()},Redirect:function(n){window.location.assign(n)},ShowRedirect:function(n){$("#signin_legend,#boilerplate_container,#body_header,#page_footer,#footer_content").hide(),$(".control-page").addClass("page_centered"),Context.redirect_target=User.addFederatedRedirectQSParameters(Context.redirect_auth_url),Constants.SUBMIT_METRICS_ON_REDIRECT&&!Context.metrics_on_redirect_submitted&&(Post.SubmitInstrumentation(),Context.metrics_on_redirect_submitted=!0),Context.username_state.enable_guests=!1,User.UsernameOnChangeHandler(),Context.redirect_countdown==0?User.Redirect(Context.redirect_target):Context.redirect_countdown==1&&$("#background_page_overlay").css("z-index",0),$("#cred_userid_container,#cred_password_container,.login_cta_container,#recover_container,input#cred_password_inputtext").hide(),$("#cred_kmsi_container,#redirect_cta_text").show(),$("#redirect_company_name_text").html(""),$("#redirect_message_container").show().css("visibility","visible").css("opacity",1).attr("aria-hidden","false"),$("#windows_redirect_message_container").show(),$("#progress_text").focus(),Context.redirect_countdown=Context.redirect_countdown-1,Context.redirectTid=setTimeout("User.ShowRedirect('"+n+"')",1e3),Util.debug_console("Redirecting in "+Context.redirect_countdown)},ForceRedirect:function(){window.location.replace(Context.redirect_target)},CancelRedirect:function(){clearTimeout(Context.redirectTid),Context.back_action_stack.DoesCancelActionExist()&&$("#cred_cancel_button").show(),$("#cred_kmsi_container").show(),$("#cred_userid_container").show(),$("#cred_password_container").show(),$(".login_cta_container").show(),$("#recover_container").show(),$("#redirect_cta_text").hide(),$("#cred_password_container").css("opacity",1),$("input#cred_password_inputtext").css("display","inline-block"),$("#redirect_message_container").hide(),$("input#cred_password_inputtext").blur(),$("#redirect_company_name_text").html(""),Context.username_state.home_realm_state==Constants.State.FEDERATED&&(Context.username_state.home_realm_state=Constants.State.NONE),Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.NONE,Context.username_state.disable_password=!0,Context.username_state.enable_progress_bar=!1,Context.username_state.enable_redirect=!1,Context.username_state.enable_guests=!0,User.UsernameOnChangeHandler(),$("input#cred_userid_inputtext").focus()},startAnimation:function(){var n=100;$(".pip").stop(!0,!0),$(".pip").each(function(){User.animatePip($(this),n),n+=100})},animatePip:function(n,t){var i=$(".login_footer_container").outerWidth(),r=i/3,u=i-3;Constants.DIR=="ltr"?n.css("left",0).hide().delay(t).show().animate({left:r},{duration:1e3,easing:"easeOutSine"}).animate({left:u},{duration:999,easing:"easeInSine"}):n.css("right",0).hide().delay(t).show().animate({right:r},{duration:1e3,easing:"easeOutSine"}).animate({right:u},{duration:999,easing:"easeInSine"})},addFederatedRedirectQSParameters:function(n){var h=n,r,s,u,e,o,f,i,t;return Util.isMSA(n)&&(n=Constants.MSA_AUTH_URL,r=decodeURIComponent(Util.ExtractQSParam("pcexp")),s=decodeURIComponent(Util.ExtractQSParam("display")),s.areEqualIgnoreCase("popup")&&(r=!1),Background.winW<Constants.MOBILE_WIDTH_THRESHOLD&&(r=!1),n.indexOf("pcexp")<0?n+="&pcexp="+encodeURIComponent(r):Constants.IS_CXH_REQUEST||(n=n.replace(/pcexp=[^&]*/i,"pcexp="+encodeURIComponent(r))),u=decodeURIComponent(Util.ExtractQSParam("vv")),u&&(n.indexOf("vv")<0?n+="&vv="+encodeURIComponent(u):n=n.replace(/vv=[^&]*/i,"vv="+encodeURIComponent(u))),n.indexOf("username")<0&&(e=decodeURIComponent(Util.ExtractQSParam("username")),o=$("#cred_userid_inputtext").val(),o!=""?n+="&username="+encodeURIComponent(o):e!=""&&(n+="&username="+encodeURIComponent(e)))),User.resize_bg(),f=decodeURIComponent(Util.ExtractQSParam("popupui")),(Constants.IS_ADAL_REQUEST||Background.winW<Constants.MOBILE_WIDTH_THRESHOLD)&&(f=1),n.indexOf("popupui")<0?n+="&popupui="+encodeURIComponent(f):n=n.replace(/popupui=[^&]*/i,"popupui="+encodeURIComponent(f)),n=n.replace(/guests%3D1/i,""),(i=h.qs("LoginOptions"))==""&&(i=$("#cred_keep_me_signed_in_checkbox").attr("checked")?"1":""),i!==""&&(t=n.qs("wreply"),t!=""?(t+=(t.indexOf("%3f")>=0?"%26":"%3f")+"LoginOptions%3d"+i,n=n.qs("wreply",t)):(t=n.qs("wctx"),t!=""&&(t+="%26LoginOptions%3d"+i,n=n.qs("wctx",t))),n=n.qs("LoginOptions",i)),Constants.PROMPT=="login"&&(n=n.qs("wfresh","0")),n},AddFooterLink:function(n,t,i,r){var u="footer_link_"+n;(r==""||r==null)&&(r=u),$(".corporate_footer").append($("<span/>").addClass("corp_link").append($("<a/>").attr("tabindex",40+n).attr("id",u).addClass(r).attr("href",i).html(t)))},DrawDefaultFooterLinks:function(){$.each(Constants.DEFAULT_ENABLED_FOOTER_LINKS,function(n,t){Constants.DEFAULT_FOOTER_LINKS[t]!=undefined&&User.AddFooterLink(n,Constants.DEFAULT_FOOTER_LINKS[t].label,Constants.DEFAULT_FOOTER_LINKS[t].url,"footer_link_"+t)})},ProcessFooterLinks:function(n){var t=-1;$.each(n,function(n,i){var r=i[0],u=i[1],f=i[2];t+=1,User.AddFooterLink(n,r,u,f)}),t<0&&User.DrawDefaultFooterLinks()},RegisterOnLoadImage:function(){$("#background_background_image").load(function(){this.width!=undefined&&(Background.background_image_loaded=!0),User.onLoadImage(),Instrument.background_image_end_time==0&&(Instrument.background_image_end_time=Util.now()),Instrument.background_image_load_time=Util.now()-Instrument.background_image_start,Instrument.background_image_loaded=!0,setTimeout(function(){User.setupPrefetching()},1e3),User.resize_bg()}).error(function(){$("#background_background_image").hide(),Instrument.background_image_loaded=!1,Instrument.background_image_load_time=Util.now()-Instrument.background_image_start,Instrument.background_image_error=!0,Instrument.background_image_end_time==0&&(Instrument.background_image_end_time=Util.now())})},IsImageLoaded:function(n){if(n==undefined||n==null||n[0]==undefined||n[0]==null||n[0].complete==undefined||n[0].complete==null)return!1;var t=n[0],i=document.documentMode;return!t.complete&&!($.browser.msie&&i<=8)?!1:typeof t.naturalWidth!="undefined"&&t.naturalWidth==0?!1:typeof t.naturalHeight!="undefined"&&t.naturalHeight==0?!1:!0},isChxOrAdalOverride:function(){return Constants.IS_CXH_REQUEST||Constants.IS_ADAL_REQUEST&&Constants.ADAL_UX_OVERRIDE}},User=MSLogin.User,MSLogin.SplitterControl={Template:'<a id="{1}_link" href="#" onclick="{0}(); return false;" tabindex="1" class="tile_link tooltip">    <table id="{1}" class="user_tile">        <tbody>        <tr class="{1}" style="cursor: pointer">            <td>                <img class="ad_glyph {1}" src="{2}" alt="{3}">            <\/td>            <td class="tile_name">                <div class="bigtext tile_primary_name windows_tile_text {1}" style="cursor: pointer">{3}<\/div>                <div class="smallertext tile_secondary_name  windows_tile_text text-caption2 {1}" style="cursor: pointer">{4}<\/div>             <\/td>         <\/tr>         <\/tbody>    <\/table><\/a>',Render:function(){var n,t;if(Constants.MEMBER_NAME===Context.username_state.last_checked_email&&$(".view-error-details-container:visible").length){$("div.progress").css("visibility","hidden"),Context.username_state.home_realm_state==Constants.State.PENDING&&(Context.username_state.home_realm_state=Constants.State.MANAGED),$("#cred_password_inputtext").focus();return}$(".login_cred_field_container").hide(),$(".login_cred_container .windows_cred_block").hide(),$(".login_cred_options_container").hide(),$(".login_user_chooser").hide(),$("#cta_error_message_text").hide(),Context.back_action_stack.DoesCancelActionExist()&&($(".login_cred_options_container").show(),$("#cred_sign_in_button").hide(),$("#cred_cancel_button").show(),$("#recover_container").hide(),$("#alternative-identity-providers").hide(),$("#cred_keep_me_signed_in_checkbox").hide(),$("#keep_me_signed_in_label_text").hide()),Context.getuserrealmresult.MicrosoftAccount!=0||Context.getuserrealmresult.NameSpaceType!=Constants.NameSpaceType.MANAGED&&(Context.getuserrealmresult.NameSpaceType!=Constants.NameSpaceType.FEDERATED||Util.isMSA(Context.getuserrealmresult.AuthURL))?Support.showClientMessage(30140):(n=$("input#cred_userid_inputtext").val().toLowerCase(),n=$.trim(n),t=Constants.TokenizedStringMsgs.UPN_DISAMBIGUATE_MESSAGE,$("#upn_needs_disambiguation_text").text(t),Support.showClientMessage(30139)),$.each(Constants.SplitterControlData,function(n,t){var i=MSLogin.SplitterControl.Template.format(t.link,t.id,t.image,t.name,t.login);$("#splitter-tiles-container").append(i)}),$(".login_splitter_control").show(),$("#splitter-tiles-container").show()},LoginAAD:function(){Context.username_state.home_realm_state=Constants.State.MANAGED,$(".login_cred_options_container").show(),$("#cred_sign_in_button").show(),$("#cred_cancel_button").hide(),$("#recover_container").show(),$("#alternative-identity-providers").show(),$("#cred_keep_me_signed_in_checkbox").show(),$("#keep_me_signed_in_label_text").show(),$("#cred_sign_in_button").removeClass("disabled_button"),$("#splitter-tiles-container").empty(),$("#splitter-tiles-container").hide(),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),$(".login_cred_container .windows_cred_block").show(),Support.hideClientErrorMessages(),Support.hideClientMessages();var n=Context.getuserrealmresult;n!=null&&n.NameSpaceType==Constants.NameSpaceType.FEDERATED&&User.ReceiveFederatedDomain(n),Support.showClientMessage(1),$("#cred_userid_container").show(),$("div.progress").css("visibility","hidden"),$("#cred_password_inputtext").focus()},LoginMSA:function(){Context.username_state.home_realm_state=Constants.State.FEDERATED,$("#splitter-tiles-container").empty(),$("#splitter-tiles-container").hide(),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),Support.hideClientErrorMessages(),Support.hideClientMessages();var n={DomainName:Constants.MSA_DOMAIN,AuthURL:Constants.MSA_AUTH_URL};User.ReceiveFederatedDomain(n)}},tenant_info={company_name:"",cta1:"",cta2:"",boilerplate1:"",boilerplate2:"",background_url:"",background_color:"",logo_url:"",domain:"",lang:""},$(document).ready(function(){pageOnReady()}),$(window).load(function(){if(Support.renderBrowserSpecific(),User.updateClientMetricsMode(),$("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),$("input#cred_userid_inputtext").val()!=undefined&&$("input#cred_userid_inputtext").val().indexOf("@")!=-1?EmailDiscovery.ShouldPerformDiscovery()?($("#cred_continue_button").focus(),$("#redirect_message_container").hide(),$("#alternative-identity-providers").hide()):(Context.username_state.home_realm_state=Constants.State.MANAGED,User.UsernameOnChangeHandler(),Util.debug_console("startup"),(!Constants.IS_CXH_REQUEST||Constants.IS_MOBILE)&&Constants.IS_CXH_REQUEST||$("input#cred_userid_inputtext").focus(),Constants.MSA_ENABLED||($("input#cred_password_inputtext").focus(),User.RefreshDomainState())):(User.UsernameOnChangeHandler(),(!Constants.IS_CXH_REQUEST||Constants.IS_MOBILE)&&Constants.IS_CXH_REQUEST||$("input#cred_userid_inputtext").focus()),Support.isUXFeatureEnabled(4096)&&($("meta[name=PageID]").attr("content")=="EmailBasedDiscovery.2.0"||$("meta[name=PageID]").attr("content")=="EmailBasedDiscoveryTiles.2.0")&&($("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),EmailDiscovery.is_enabled_workflow=!0),Support.isUXFeatureEnabled(512)&&Util.ExtractQSParam("popupui")=="1"){try{var n=$("meta[name=viewport]");n.attr("content","width=300, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, height=device-height")}catch(t){}$("html").css("background-color","#FFFFFF"),$("body").css("background-color","#FFFFFF"),$("#background_branding_container").css("background-color","#FFFFFF")}Instrument.document_load_end_time=Util.now()}),MSLogin.EmailDiscovery={Strings:{},WorkflowStates:{NONE:0,INIT:1,LOOKING:2,SPLITTER:3,MSA:4,AAD:5},is_enabled_workflow:!1,IsDiscoveryPage:function(){return Support.isUXFeatureEnabled(32)&&EmailDiscovery.is_enabled_workflow},ShouldPerformDiscovery:function(){return Support.isUXFeatureEnabled(32)&&Context.email_discovery_mode},IsTilesModeActivated:function(){return Support.isUXFeatureEnabled(32)&&Context.email_discovery_tiles_mode},Init:function(){Context.email_discovery_mode=!0,EmailDiscovery.ShouldPerformDiscovery()&&(EmailDiscovery.is_enabled_workflow=!0),$("#cred_sign_in_button").hide(),$("#cred_cancel_button").hide(),$("#cred_kmsi_container").hide(),$("#recover_container").hide(),$("#cred_password_container").hide(),$("#login_cta_text").hide(),$("#login_user_chooser").hide(),$("#forget_tile_container").hide(),$("#guest_hint_text").hide(),$(".guest_redirect_container").hide(),$(".login_cta_container").show(),$(".login_cred_options_container").addClass("email_discovery"),$("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),$("#looking_container").hide(),$("div.progress").css("visibility","hidden"),Context.username_state.last_checked_email=Context.username_state.last_checked_email||"",Context.username_state.home_realm_state=Constants.State.NONE,Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.NONE;var n=decodeURIComponent(Util.ExtractQSParam("username")),t=$("#cred_userid_inputtext").val();EmailDiscovery.IsTilesModeActivated()&&n!==t&&($("input#cred_userid_inputtext").val(""),$("input#cred_userid_inputtext").focus()),EmailDiscovery.HideSplitter(),EmailDiscovery.ShowEmailDiscovery()},Initialize:function(){$("input#cred_userid_inputtext").keydown(function(n){EmailDiscovery.ShouldPerformDiscovery()&&User.KeyPressEnter(n,function(){n.preventDefault(),EmailDiscovery.ValidateUserInput()},13)}),$("#cred_continue_button").keydown(function(n){EmailDiscovery.ShouldPerformDiscovery()&&User.KeyPressEnter(n,function(){n.preventDefault(),EmailDiscovery.ValidateUserInput(),User.RefreshDomainState()},13)}),$("#cred_try_again_button").keydown(function(n){EmailDiscovery.ShouldPerformDiscovery()&&User.KeyPressEnter(n,function(){n.preventDefault(),EmailDiscovery.ValidateUserInput(),User.RefreshDomainState()},13)}),$("a#looking_cancel_link").attr("href","javascript:Context.back_action_stack.TriggerCancelAction();")},SetupTilesForSplitter:function(){users!=Constants.EMAIL_DISCOVERY_DEFAULT_TILES&&(Context.email_discovery_splitter_shown=!0,Context.user_tiles=Tiles.users,Tiles.users=Constants.EMAIL_DISCOVERY_DEFAULT_TILES,users=Tiles.users,$.each(users,function(n,t){t.ignore_length=!0}))},RevertUserTiles:function(){users==Constants.EMAIL_DISCOVERY_DEFAULT_TILES&&(Context.email_discovery_splitter_shown=!1,Tiles.users=Context.user_tiles,users=Tiles.users)},ShowPostErrorMessage:function(){Context.email_discovery_mode=!1,EmailDiscovery.is_enabled_workflow=!0,Context.email_discovery_splitter_shown=!1,$("meta[name=PageID]").attr("content").indexOf("EmailBasedDiscoveryTiles")==-1&&Context.back_action_stack.AddAction(Constants.CancelAction.FROM_MANY_TO_EMAILDISCOVERY_INIT),$("#cred_cancel_button").show()},ValidateUserInput:function(){User.UpdateUsernameState(),Context.username_state.is_empty?(Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.NONE,EmailDiscovery.ShowEmailDiscovery(30127)):Context.username_state.is_partial&&(Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.NONE,EmailDiscovery.ShowEmailDiscovery(30145))},PerformEmailBasedDiscovery:function(){var n=$("input#cred_userid_inputtext").val().toLowerCase();if(n=$.trim(n),Context.email_discovery_timeout_occurred=!1,Context.email_discovery_error_message=null,!Support.validateUsernameCredInput(n)){Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.NONE,EmailDiscovery.ShowEmailDiscovery(30064);return}Context.email_discovery_lookup_xhr=$.ajax({headers:{Accept:"application/json"},url:Constants.EMAIL_DISCOVERY_SERVICE_URI.replace("{0}",encodeURI(n)),dataType:"json",data:{stsRequest:Constants.CONTEXT,checkForMicrosoftAccount:!0},success:EmailDiscovery.ReceiveHomeRealmInfo,error:EmailDiscovery.ReceiveHomeRealmError,timeout:Constants.EMAIL_DISCOVERY_SERVICE_TIMEOUT}),Context.username_state.last_checked_email=n,Context.username_state.home_realm_state=Constants.State.PENDING,MSLogin.EmailDiscovery.HideEmailDiscovery(),MSLogin.EmailDiscovery.ShowLookingForAccountLayout()},ReceiveHomeRealmInfo:function(n){Context.email_discovery_response={AAD:n},EmailDiscovery.HideLookingForAccountLayout(),Context.back_action_stack.RemoveLastCancelAction();var t=EmailDiscovery.GetAccountStateFromResponse({AAD:n});EmailDiscovery.PerformUIAction(t)},GetAccountStateFromResponse:function(n){var i=Constants.EmailDiscoveryAccountState,o,s,f;if(n==null||n.AAD==null)return Context.username_state.home_realm_state=Constants.State.INVALID,i.ERROR;var e=n.AAD.MicrosoftAccount,t=n.AAD,u="",r="";if(e==null)u="TIMED_OUT";else if(u=EmailDiscovery.GetEnumKeyName(Constants.MSAccount,e),u==null)return i.ERROR;if(t==="timeout")r="TIMED_OUT",Context.username_state.home_realm_state=Constants.State.INVALID;else{if(r=EmailDiscovery.GetEnumKeyName(Constants.NameSpaceType,t.NameSpaceType),o=t.NameSpaceType===Constants.NameSpaceType.FEDERATED&&(t.AuthURL==undefined||t.AuthURL==null||t.AuthURL===""),r==null||o)return Context.username_state.home_realm_state=Constants.State.INVALID,i.ERROR;Context.username_state.home_realm_state=Constants.State[r]}return(s="AAD_"+r+"_AND_MSA_"+u,f=i[s],f==undefined)?i.Error:f},PerformUIAction:function(n){var t=Constants.EmailDiscoveryAccountState,i=Context.email_discovery_response,r=Constants.EMAIL_DISCOVERY_DEFAULT_TILES;Context.email_discovery_easi_user=!1,Context.email_discovery_splitter_shown=!1,Instrument.email_discovery_ui_code=n;switch(n){case t.AAD_UNKNOWN_AND_MSA_NOT_EXIST:Constants.SHOULD_HIDE_SIGNUP||$("#create_msa_account_container").show(),EmailDiscovery.ShowEmailDiscovery(30146);break;case t.AAD_UNKNOWN_AND_MSA_EXISTS:Context.email_discovery_easi_user=!0,EmailDiscovery.LoginMSOAccount();break;case t.AAD_FEDERATED_AND_MSA_NOT_EXIST:if(Util.isMSA(i.AAD.AuthURL)){Constants.SHOULD_HIDE_SIGNUP||$("#create_msa_account_container").show(),EmailDiscovery.ShowEmailDiscovery(30146);break}case t.AAD_MANAGED_AND_MSA_NOT_EXIST:EmailDiscovery.LoginAADAccount();break;case t.AAD_FEDERATED_AND_MSA_EXISTS:if(Util.isMSA(i.AAD.AuthURL)){EmailDiscovery.LoginMSOAccount();break}EmailDiscovery.SetupTilesForSplitter(),Context.redirect_auth_url=i.AAD.AuthURL,Context.redirect_target=User.addFederatedRedirectQSParameters(i.AAD.AuthURL),Context.federated_domain=i.AAD.DomainName,users[0].authUrl=i.AAD.AuthURL;case t.AAD_MANAGED_AND_MSA_EXISTS:Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_TO_EMAILDISCOVERY_START),$("#cred_cancel_button").show(),EmailDiscovery.ShowSplitter();break;case t.AAD_FEDERATED_AND_MSA_THROTTLED:case t.AAD_FEDERATED_AND_MSA_TIMED_OUT:EmailDiscovery.SetupTilesForSplitter(),Context.redirect_auth_url=i.AAD.AuthURL,Context.redirect_target=User.addFederatedRedirectQSParameters(i.AAD.AuthURL),Context.federated_domain=i.AAD.DomainName,users[0].authUrl=i.AAD.AuthURL,Context.email_discovery_timeout_occurred=!0,Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_TO_EMAILDISCOVERY_START),EmailDiscovery.ShowSplitter();break;case t.AAD_MANAGED_AND_MSA_THROTTLED:case t.AAD_MANAGED_AND_MSA_TIMED_OUT:Context.email_discovery_timeout_occurred=!0,Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_TO_EMAILDISCOVERY_START),EmailDiscovery.ShowSplitter();break;case t.AAD_TIMED_OUT_AND_MSA_THROTTLED:case t.AAD_TIMED_OUT_AND_MSA_TIMED_OUT:case t.AAD_UNKNOWN_AND_MSA_THROTTLED:case t.AAD_UNKNOWN_AND_MSA_TIMED_OUT:case t.AAD_TIMED_OUT_AND_MSA_NOT_EXIST:case t.ERROR:Constants.SHOULD_HIDE_SIGNUP||$("#create_msa_account_container").show();case t.AAD_TIMED_OUT_AND_MSA_EXISTS:default:Context.email_discovery_timeout_occurred=!0,Context.email_discovery_use_msa_api?Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_TO_EMAILDISCOVERY_START):EmailDiscovery.IsTilesModeActivated()&&Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_SPLITTER_FALLBACK_TO_TILES),EmailDiscovery.ShowSplitter()}Context.email_discovery_easi_user&&(Instrument.possible_easi_user=1)},ReceiveHomeRealmError:function(n,t){t=="abort"?(EmailDiscovery.HideLookingForAccountLayout(),EmailDiscovery.ShowEmailDiscovery()):(Context.back_action_stack.RemoveLastCancelAction(),EmailDiscovery.HandleTimeoutHomeRealmInfo())},HandleTimeoutHomeRealmInfo:function(){Context.email_discovery_response=null,Context.email_discovery_timeout_occurred=!0,Context.username_state.home_realm_state=Constants.State.INVALID,EmailDiscovery.HideLookingForAccountLayout(),EmailDiscovery.PerformUIAction(Constants.EmailDiscoveryAccountState.ERROR)},ShowEmailDiscovery:function(n){if(Context.email_discovery_workflow_state!==EmailDiscovery.WorkflowStates.INIT){if(Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.INIT,!Context.email_discovery_use_msa_api){EmailDiscovery.HideEmailDiscovery(),EmailDiscovery.HandleTimeoutHomeRealmInfo(),EmailDiscovery.ShowSplitter();return}var t=!1;Support.hideClientErrorMessages(),Support.hideClientMessages(),Context.username_state.home_realm_state=Constants.State.NONE,Context.username_state.last_checked_email=Context.username_state.last_checked_email||"",n==undefined?Support.showClientMessage(30136):(Support.showClientError(n),n===30146&&(t=!0)),$("#forget_tile_container").hide(),$("#cred_userid_container").show(),$("#cred_userid_inputtext").show(),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),$(".login_cred_options_container").addClass("email_discovery"),$("#cred_userid_inputtext").focus(),t?($("#cred_try_again_button").show(),$("#cred_continue_button").hide()):($("#cred_continue_button").show(),$("#cred_try_again_button").hide()),$("#cred_password_container").hide(),$("#recover_container").hide(),$("#cred_kmsi_container").hide(),$("#switch_user_container").hide(),$("#alternative-identity-providers").hide()}},HideEmailDiscovery:function(){$("#cred_userid_container").hide(),$("#cred_continue_button").hide(),$("#cred_cancel_button").hide(),$("#cred_try_again_button").hide(),$("#create_msa_account_container").hide(),Support.hideClientErrorMessages(),Support.hideClientMessages(),Context.username_state.enable_redirect=!1,Context.username_state.enable_guests=!1,User.UsernameOnChangeHandler()},BackToUserTiles:function(){EmailDiscovery.HideEmailDiscovery(),Context.email_discovery_mode=!1,EmailDiscovery.RevertUserTiles(),Tiles.drawUsers(),$("#tiles_cta_text").show(),$(".login_cred_options_container").removeClass("email_discovery"),$("#create_msa_account_container").hide(),Context.username_state.home_realm_state=Constants.State.NONE,Tiles.CancelTileRedirect()},ShowLookingForAccountLayout:function(){Context.email_discovery_workflow_state!=EmailDiscovery.WorkflowStates.LOOKING&&(Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.LOOKING,Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_LOOKING_FOR_ACCOUNT_TO_EMAILDISCOVERY_START),$("#looking_container").show(),$("a#looking_cancel_link").focus(),$("div.progress").css("visibility","visible"),User.startAnimation(),Context.animationTid=setInterval(User.startAnimation,3500))},HideLookingForAccountLayout:function(){$("#looking_container").hide(),$("div.progress").css("visibility","hidden"),clearInterval(Context.animationTid)},CancelLookingForAccount:function(){Context.email_discovery_lookup_xhr.abort()},ShowSplitter:function(){var n,t;Context.email_discovery_workflow_state!==EmailDiscovery.WorkflowStates.SPLITTER&&(Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.SPLITTER,Context.email_discovery_splitter_shown=!0,EmailDiscovery.SetupTilesForSplitter(),$(".login_cta_container").show(),$("#login_user_chooser").show(),$(".login_user_chooser").show(),Tiles.drawUsers(),Context.back_action_stack.DoesCancelActionExist()&&$("#cred_cancel_button").show(),Context.email_discovery_use_msa_api?($(".login_cred_options_container").css("display","block"),Context.email_discovery_timeout_occurred?Support.showClientMessage(30140):(n=$("input#cred_userid_inputtext").val().toLowerCase(),n=$.trim(n),t=Constants.TokenizedStringMsgs.UPN_DISAMBIGUATE_MESSAGE,$("#upn_needs_disambiguation_text").text(t),Support.showClientMessage(30139))):(EmailDiscovery.IsTilesModeActivated()||$(".login_cred_options_container").removeClass("email_discovery"),$(".login_cred_options_container").css("display","block"),$("#create_msa_account_container").show(),Support.showClientMessage(30173)))},HideSplitter:function(){$("#cred_cancel_button").hide(),$("#login_user_chooser").empty(),$(".login_user_chooser").hide(),$("#login_user_chooser").hide(),$("#create_msa_account_container").hide(),Support.hideClientErrorMessages(),Support.hideClientMessages()},BackSplitter:function(){EmailDiscovery.HideSplitter(),EmailDiscovery.ShowEmailDiscovery()},LoginMSOAccount:function(){if(Context.email_discovery_workflow_state!=EmailDiscovery.WorkflowStates.MSA){Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.MSA;var n={DomainName:Constants.MSA_DOMAIN,AuthURL:Constants.MSA_AUTH_URL};EmailDiscovery.HideSplitter(),EmailDiscovery.InitRedirect(),User.ReceiveFederatedDomain(n)}},LoginAADAccount:function(){Context.email_discovery_workflow_state!=EmailDiscovery.WorkflowStates.AAD&&(Context.email_discovery_workflow_state=EmailDiscovery.WorkflowStates.AAD,EmailDiscovery.HideSplitter(),!Context.email_discovery_use_msa_api||(Context.email_discovery_timeout_occurred||Context.email_discovery_response==null)&&Context.username_state.home_realm_state==Constants.State.INVALID?(EmailDiscovery.ShowAADLoginLayout(),Context.username_state.home_realm_state=Constants.State.NONE,$("#cred_userid_inputtext").focus()):Context.username_state.home_realm_state==Constants.State.FEDERATED?(Context.email_discovery_timeout_occurred&&!Util.isMSA(Context.email_discovery_response.AAD.AuthURL)&&(Context.email_discovery_easi_user=!1),EmailDiscovery.InitRedirect(),User.ReceiveFederatedDomain(Context.email_discovery_response.AAD)):(EmailDiscovery.ShowAADLoginLayout(),User.ReceiveManagedDomain(Context.email_discovery_response.AAD),$("#cred_password_inputtext").focus()))},InitRedirect:function(){$("input#cred_userid_inputtext").hide(),$("#cred_userid_container").show(),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),$("#cred_kmsi_container").show(),$("#cred_keep_me_signed_in_checkbox").show(),Context.email_discovery_splitter_shown?Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_REDIRECT_TO_EMAILDISCOVERY_SPLITTER):Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_REDIRECT_TO_EMAILDISCOVERY_START),$("div.progress").css("visibility","visible"),$(".login_cred_options_container").removeClass("email_discovery"),User.startAnimation(),Context.animationTid=setInterval(User.startAnimation,3500)},ShowAADLoginLayout:function(){Context.email_discovery_mode=!1,Context.email_discovery_splitter_shown?Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_AAD_LOGIN_TO_EMAILDISCOVERY_SPLITTER):Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_AAD_LOGIN_TO_EMAILDISCOVERY_START),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),$(".login_cred_options_container").removeClass("email_discovery"),$("#cred_userid_inputtext").show(),$("#cred_password_inputtext").show(),$("#cred_userid_container").show(),$("#cred_sign_in_button").show(),$("#cred_kmsi_container").show(),$("#recover_container").show(),$("#cred_password_container").show(),$("#login_cta_text").show(),$("#cred_cancel_button").show(),TenantBranding.setUserIdHintAndKmsi()},HideAADLoginLayout:function(){Context.email_discovery_mode=!0,TenantBranding.RemoveTenantBrandingAndApplyWorkload(),$(".login_cred_options_container").addClass("email_discovery"),$("#cred_password_inputtext").val(""),$("#cred_sign_in_button").hide(),$("#cred_kmsi_container").hide(),$("#recover_container").hide(),$("#cred_password_container").hide(),$("#login_cta_text").hide(),$("#cred_cancel_button").hide()},CancelRedirect:function(){clearTimeout(Context.redirectTid),Context.username_state.home_realm_state=Constants.State.NONE,$("div.progress").css("visibility","hidden"),clearInterval(Context.animationTid),$("#redirect_message_container").hide(),$("#cred_sign_in_button").hide(),$("#redirect_cta_text").hide(),$("#redirect_company_name_text").html(""),$("#cred_kmsi_container").hide(),$(".login_cred_options_container").addClass("email_discovery"),$("#redirect_message_container").css("opacity",0),$("#redirect_message_container").addClass("hidden"),$("#redirect_message_container").addClass("no_display"),Context.email_discovery_mode=!0},GetEnumKeyName:function(n,t){for(var i in n)if(n[i]==t)return i;return null}},EmailDiscovery=MSLogin.EmailDiscovery,$(document).ready(function(){EmailDiscovery.Initialize()}),origHide=jQuery.fn.hide,jQuery.fn.hide=function(n,t){if(n){var i=this;origlHide.apply(this,[n,function(){try{i.attr("aria-hidden","true")}catch(n){}t&&t.call(i)}])}else{origHide.apply(this,arguments);try{this.attr("aria-hidden","true")}catch(r){}}return this},origShow=jQuery.fn.show,jQuery.fn.show=function(n,t){if(n){var i=this;origShow.apply(this,[n,function(){try{i.removeAttr("aria-hidden")}catch(n){}t&&t.call(i)}])}else{origShow.apply(this,arguments);try{this.removeAttr("aria-hidden")}catch(r){}}return this},origAddClass=jQuery.fn.addClass,jQuery.fn.addClass=function(n){if(n=="no_display"||n=="hidden")try{this.attr("aria-hidden","true")}catch(t){}return origAddClass.apply(this,arguments),this},origRemoveClass=jQuery.fn.removeClass,jQuery.fn.removeClass=function(n){if(n=="no_display"||n=="hidden")try{this.removeAttr("aria-hidden","true")}catch(t){}return origRemoveClass.apply(this,arguments),this},MSLogin.Support={are_cookies_enabled:function(){var n=navigator.cookieEnabled?!0:!1;return typeof navigator.cookieEnabled!="undefined"||n||(document.cookie="testcookie",n=document.cookie.indexOf("testcookie")!=-1?!0:!1),n},is_placeholder_supported:function(){var n,t;return $.browser.msie&&(n=document.documentMode,n<12)?!1:navigator.userAgent.indexOf("rv:11.0")>=0?!1:(t=document.createElement("input"),"placeholder"in t)},is_prefetch_supported:function(){return navigator.userAgent.match(/iPad/)?!1:!0},is_audio_captcha_supported:function(){var t=document.documentMode,n=!0;return $.browser.msie&&t<=8?n=!1:navigator.userAgent.match(/IEMobile/)?n=!1:navigator.userAgent.match(/Android 2\.3/)?n=!1:navigator.userAgent.match(/iPad/)?n=!1:navigator.userAgent.match(/iPhone/)&&(n=!1),n},showClientError:function(n){var t=!1;return n==0?($("#cta_error_message_text").hide(),$("#login_cta_text").hide(),$("#cta_client_error_text").hide(),$("#login_cta_text").show(),$("#create_msa_account_container").removeClass("no-display")):($(".client_error_msg").each(function(){$(this).hide(),$("#"+$(this).data("elementid")).removeClass("inputState_error")}),$("#cta_error_message_text").hide(),$("#login_cta_text").hide(),$("#cta_client_error_text").show(),$(".client_error_msg."+n.toString()).each(function(){$(this).show();var n=$("#"+$(this).data("elementid"));n.addClass("inputState_error"),n.length>0&&(n[n.length-1].focus(),t=!0)})),t},hideClientError:function(n){$(".client_error_msg."+n.toString()).hide(),$("#login_cta_text").show(),$("#create_msa_account_container").removeClass("no-display")},hideClientErrorMessages:function(){$("#cta_error_message_text").hide(),$("#login_cta_text").hide(),$("#cta_client_error_text").hide(),$(".client_error_msg").hide(),$("#cta_error_message_text").hide(),$("#login_cta_text").show(),$("#create_msa_account_container").removeClass("no-display")},showClientMessage:function(n){$(".cta_message_text").hide(),$("#cta_client_message_text").show(),$(".cta_message_text."+n).show()},hideClientMessages:function(){$(".cta_message_text").hide(),$("#cta_client_message_text").hide()},validateUsernameCredInput:function(n){var t=MSLogin.Constants;return Constants.IS_MSA_PHONE_USERNAME_SUPPORTED&&t&&t.REGEX_EMAIL&&t.REGEX_PHONE?t.REGEX_EMAIL.test(n)||t.REGEX_PHONE.test(n):t.REGEX_EMAIL.test(n)},validateCredInputs:function(){var t=$("input#cred_userid_inputtext").val(),i=$("input#cred_password_inputtext").val(),n=30067,r=decodeURIComponent(Util.ExtractQSParam("nca")),u;return(t=t.toLowerCase())==""&&i==""?n=30067:t==""?n=30067:r=="true"||r=="1"||Constants.IS_NAME_COEXISTENCE_ACCOUNT||Support.validateUsernameCredInput(t)?i==""?(n=30111,$("input#cred_password_inputtext").focus()):n=0:(n=30064,t!=null&&t.indexOf("\\")!=-1&&(n=30066)),u=Support.showClientError(n),n?(MSLogin.Util.LogCxhTelemetry("AADLoginPageClientError",n),u||($("input#cred_userid_inputtext").css("display")!=undefined&&$("input#cred_userid_inputtext").css("display")!="none"&&$("input#cred_password_inputtext").val()!=""?$("input#cred_userid_inputtext").focus():$("input#cred_password_inputtext").focus()),!1):!0},isUXFeatureEnabled:function(n){var t=!1,i=parseInt(Util.getCookie(MSLogin.OptIn.optin_cookie_name)),r=parseInt(Util.ExtractQSParam("msoptin-newui"));return n&Constants.FEATURE_SLOT_MASK?t=!0:n&i&&(t=!0),n&r&&(t=!0),!t||n&Constants.FEATURE_SLOT_THRESHOLD||(t=!1),t},forceCredBlockHeight:function(){},renderBrowserSpecificForNarrowWidth:function(n){User.resize_bg(),Background.winW<Constants.MOBILE_WIDTH_THRESHOLD&&($.browser.msie&&n>=8&&$(".push").css("height","2em"),$.browser.msie&&n<=7&&($(".login_panel").css("padding-left","0px"),$(".login_cred_field_container").css("margin-left","0px"),$("input#cred_userid_inputtext").css("margin-left","15px"),$("input#cred_password_inputtext").css("margin-left","15px")),$.browser.msie&&n<=6&&$(".login_panel").css("padding-left","50px"))},renderBrowserSpecificForNarrowHeight:function(){if(User.resize_bg(),Background.winH<Constants.MOBILE_HEIGHT_THRESHOLD||Support.isUXFeatureEnabled(512)&&Util.ExtractQSParam("popupui")=="1"){var n=!0;navigator.userAgent.match(/IEMobile/)&&(n=!1),navigator.userAgent.match(/Android/)&&(n=!1),navigator.userAgent.match(/iPhone/)&&(n=!1),navigator.userAgent.match(/iPad/)&&(n=!1),n?$("#footer_links_container").addClass("sticky_footer"):$("#footer_links_container").removeClass("sticky_footer")}},renderBrowserSpecific:function(){var n=document.documentMode,i,t;$.browser.msie&&n>=8&&($(".push").css("display","inline-block"),$(".push").css("height","6em")),(navigator.userAgent.match(/iPad/)||navigator.userAgent.match(/iPhone/))&&(Support.forceCredBlockHeight(),$(".cred").css("margin-bottom","-3em"),$(".login_guest_container").css("margin-bottom","0px")),$.browser.msie&&n>8&&$(".show_other").css("margin-left","-5px"),$.browser.msie&&n<=7&&($(".ie_legacy").css("display","none"),$("body").css("background-color",$("html").css("background-color")),$("a.tile_link").css("margin-left","0px"),$("table.user_tile").css("margin-left","0px"),$("table.user_tile").css("margin-bottom","10px"),$(".show_other").css("margin-left","0px")),$.browser.msie&&n<=6&&$("body").css("overflow-y","hidden"),$.browser.mozilla&&$(".input_border").addClass("high_contrast_border"),navigator.userAgent.match(/IEMobile/),navigator.userAgent.match(/Android 2\.3/)&&($("meta[name=PageID]").attr("content")!="optin.2.0"&&$("body").css("font-size","0.5em"),$(".login_footer_container").css("margin-top","-12em"),$(".login_guest_container").css("padding-top","0px"),$(".cred").css("padding-bottom","10em"),Support.forceCredBlockHeight()),navigator.userAgent.match(/Android/)&&$("body").css("height","100vh"),$.browser.msie&&n==10&&($(".cred").css("padding-bottom","100px"),i=$(window).height()-$(".login_footer_container").height()+30,$("#login_panel_center").css("height",i+"px"),document.body.onresize=function(){var n=$(window).height()-$(".login_footer_container").height()+30;$("#login_panel_center").css("height",n+"px")}),$.browser.webkit&&$("form :input").blur(function(){User.resize_bg()}),Support.renderBrowserSpecificForNarrowWidth(n),Support.renderBrowserSpecificForNarrowHeight(n),$.browser.msie&&document.documentMode<11&&($(".cred").css("padding-bottom","0px"),t=function(){var n=$(window).height()-$("#true_inner").height()-$(".push").height()-60;$("#login_panel_center").css("height",n>0?$(window).height()-15:"")},document.body.onresize=t,t())},getViewport:function(){var n,t;return typeof window.innerWidth!="undefined"?(n=window.innerWidth,t=window.innerHeight):typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0?(n=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(n=document.getElementsByTagName("body")[0].clientWidth,t=document.getElementsByTagName("body")[0].clientHeight),[n,t]},showIllustration:function(){var t=Support.getViewport(),n=!0;return Background.winW<Constants.MOBILE_WIDTH_THRESHOLD?n=!1:t[0]<Constants.MOBILE_WIDTH_THRESHOLD?n=!1:navigator.userAgent.match(/IEMobile/)?n=!1:navigator.userAgent.match(/Android 2\.3/)?n=!1:Support.isUXFeatureEnabled(512)&&Util.ExtractQSParam("popupui")=="1"&&(n=!1),n},showTileTooltips:function(){var n=!0;return navigator.userAgent.match(/iPad/)?n=!1:navigator.userAgent.match(/iPhone/)&&(n=!1),n},renderForVirtualKeyboard:function(){return},isDefined:function(n){return n!=null&&n!=undefined&&(n.length>0||typeof n=="object"||typeof n=="boolean"||typeof n=="number")},getDomain:function(n){var i=$.trim(n),r=function(n){return n.indexOf("@")!=-1&&n.indexOf("@")<n.length},u=function(n){return Support.isDefined(n)&&r(n)},t;return u(i)&&(t=n.substring(i.indexOf("@")+1),t.length>0)?t:null},checkIfDomainsMatch:function(n,t){var i=Support.getDomain(n),r=Support.getDomain(t);return i!=null&&r!=null?i.toLowerCase()==r.toLowerCase():!1},GetOriginalPasswordResetLinkUrl:function(){var n=Context.password_reset_link_url,t;return Support.isDefined(n)||(t=$("a#cred_forgot_password_link"),Support.isDefined(t)&&Support.isDefined(t.attr("href"))&&(n=t.attr("href")),Support.isDefined(n)?Context.password_reset_link_url=n:n=null),n},UpdatePasswordResetLink:function(){var r=$("a#cred_forgot_password_link"),n=Support.GetOriginalPasswordResetLinkUrl(),t,i;Support.isDefined(r)&&Support.isDefined(n)&&(t=decodeURIComponent(Util.ExtractQSParam("whr")),i=$("input#cred_userid_inputtext").val(),n.indexOf("?")==-1&&(n+="?"),Support.isDefined(t)&&(n+="&whr="+encodeURIComponent(t)),Support.isDefined(i)&&(n+="&username="+encodeURIComponent(i)),r.attr("href",n))},IsBrowserVersionGreaterOrEqual:function(n,t){var i,r,u;if(t=="*")return!0;if(!Support.isDefined(n)||!Support.isDefined(t))return!1;var o=n.split("."),f=t.split("."),e=!1;for(i=0;i<f.length;i++){if((r=parseInt(o[i]),u=parseInt(f[i]),isNaN(r)||isNaN(u))||r<u)return!1;if(r>u)return!0;e=!0}return e},CheckIfBrowserIsSupported:function(n){var i,t,r,u;if(Support.isDefined($.browser)&&Support.isDefined(n))for(i=0;i<n.length;i++)if(t=n[i],Support.isDefined(t)&&t.length==2&&(r=t[0],u=t[1],Support.isDefined($.browser[r])&&$.browser[r]&&Support.isDefined(u)&&Support.IsBrowserVersionGreaterOrEqual($.browser.version,u)))return!0;return!1},ViewErrorDetails:function(){$(".view-error-details-title").toggleClass("no_display"),$(".view-error-details-content").toggleClass("no_display")},IForgotMyPassword:function(){$(".i-forgot-my-password-content").toggleClass("no_display")},LegalActionLink:function(n){$.ajax({url:n,data:{IsAjax:!0},success:function(n){$(".login_panel_layout").hide(),$(".legal_container").html(n).show(),$("#legal-back-button").click(function(){$(".legal_container").hide(),$(".login_panel_layout").show()})},error:function(){}})}},Support=MSLogin.Support,jQuery.support.placeholder=function(){return Support.is_placeholder_supported()}(),jQuery.support.cookies=function(){var n=navigator.cookieEnabled?!0:!1;return typeof navigator.cookieEnabled!="undefined"||n||(document.cookie="testcookie",n=document.cookie.indexOf("testcookie")!=-1?!0:!1),n}(),HIP_MODE={VISUAL:0,AUDIO:1},$("#hip_code_inputtext").focus(function(){HIP.startTime=new Date}),$("#hip_code_inputtext").blur(function(){HIP.endTime=new Date}),HIP={data:null,mode:HIP_MODE.VISUAL,startTime:new Date,endTime:new Date,getChallengeScript:function(){var n=HIP.data.challengeURL;return n+("?k="+HIP.data.captchaKey)+"&ajax=1"+("&"+HIP.data.challengeExtraParams),$("#hip_script_container").append($("<script/>").attr("src",n)),n},getToken:function(){return HIP.data.visualToken},getStreamURL:function(){return HIP.mode==HIP_MODE.VISUAL?HIP.data.visualImageURL:HIP.mode==HIP_MODE.AUDIO?HIP.data.audioStreamURL:void 0},hideVisual:function(){$("#hip_show_image_container").hide(),$("#hip_show_audio_container").show(),HIP.mode=HIP_MODE.VISUAL,HIP.getNextValue()},hideAudio:function(){$("#hip_show_image_container").show(),$("#hip_show_audio_container").hide(),HIP.mode=HIP_MODE.AUDIO,HIP.getNextValue()},createPlayer:function(){$("#hip_image_container").html($("<audio/>").attr("controls","controls").attr("id","hip_audio_control").append($("<source/>").attr("src",HIP.getStreamURL()).attr("type","audio/wav")))},playPlayer:function(){$("#hip_audio_control").play()},stopPlayer:function(){$("#hip_audio_control").stop()},getChallenge:function(n){for(var i,t=0;t<n;t++)i=Util.getCookie("HIPChallenge"+t);return i},getSolution:function(){var n="Fr=";return n+=",type=",HIP.mode==HIP_MODE.VISUAL?n+="visual":HIP.mode==HIP_MODE.AUDIO&&(n+="audio"),n+(",Solution="+$("#hip_code_inputtext").val())+(",HIPFrame="+HIP.getToken())+("|HIPChallenge0="+HIP.getChallenge(parseInt(HIP.data.visualNumber)))+("|HIPTime="+(HIP.endTime-HIP.startTime))},refresh:function(){if(HIP.data!=null)if(HIP.mode==HIP_MODE.VISUAL)$("#hip_image_container").html($("<img/>").attr("id","hip_challenge_image").attr("alt",Constants.HIP_IMAGE_ALT_TEXT).attr("src",HIP.getStreamURL())),$("#hip_challenge_image").css("width",HIP.data.visualImageWidth),$("#hip_challenge_image").css("height",HIP.data.visualImageHeight);else if(HIP.mode==HIP_MODE.AUDIO)return HIP.createPlayer()},getNextValue:function(){var n=Constants.HIP_DATA_URL;n=n.replace("gethip.srf","hip_data.srf"),HIP.mode==HIP_MODE.AUDIO&&(n=n.replace("visual","audio")),$("#hip_script_container").append($("<script/>").attr("type","text/javascript").attr("src",n)),HIP.data!=null&&$("#hip_help_link").attr("href",HIP.data.helpLink)}},$(document).ready(function(){($("#hip_refresh_link").attr("href","javascript:HIP.getNextValue();"),Support.is_audio_captcha_supported()?($("#hip_show_audio_link").attr("href","javascript:HIP.hideAudio();"),$("#hip_show_image_link").attr("href","javascript:HIP.hideVisual();")):($("#hip_show_audio_link").hide(),$("#hip_show_image_link").hide(),$("#hip_divider_text").hide()),Context.has_forced_cred_block_height||$(".login_cred_options_container")==undefined)||(Context.has_forced_cred_block_height=!0)}),MSLogout={logoutstate:null,success:[],error:[],noOfIncompleteSites:0,thirdPartyCookieEnabled:-1,showSignOutInfo:function(){MSLogout.checkThirdPartyCookies(),$.each(MSLogout.logoutstate.sites,function(n,t){MSLogout.checkSiteCookies(t)})},checkThirdPartyCookies:function(){if(MSLogout.logoutstate.thirdPartyCookieURL!=undefined)var n=$("<img/>").attr("src",MSLogout.logoutstate.thirdPartyCookieURL).load(function(){MSLogout.thirdPartyCookieEnabled=ThirdPartyCookieStates.ENABLED}).error(function(){MSLogout.thirdPartyCookieEnabled=ThirdPartyCookieStates.DISABLED}()).addClass("hidden")},checkSiteCookies:function(n){var n=n,t;MSLogout.noOfIncompleteSites++,t=$("<img/>").attr("src",n.url).load(function(){var t=n;return function(){MSLogout.noOfIncompleteSites--,MSLogout.success.push(t)}}()).error(function(){var t=n;return function(){MSLogout.noOfIncompleteSites--,MSLogout.error.push(t)}}()).addClass("hidden"),$("body").append(t)},displaySiteList:function(){if(MSLogout.thirdPartyCookieEnabled!=ThirdPartyCookieStates.NOT_LOADED&&MSLogout.noOfIncompleteSites==0){$(".signed_out_sites").show(),$("#more_info_text").hide();var n="#success_signed_out_sites";MSLogout.thirdPartyCookieEnabled==ThirdPartyCookieStates.DISABLED&&(n="#error_signed_out_sites"),$.each(MSLogout.success,function(t,i){$(n).append($("<div/>").attr("id","site_"+i.id).text(i.name+" ("+i.id+")"))}),$.each(MSLogout.error,function(n,t){$("#error_signed_out_sites").append($("<div/>").attr("id","site_"+t.id).text(t.name+" ("+t.id+")"))}),MSLogout.displaySAMLList()}},displaySAMLList:function(){var n=MSLogout.logoutstate.samlNamespace,t,i;n!=undefined&&(t=n.status?"#success_signed_out_sites":"#error_signed_out_sites",i=$("<div/>").html(n.name).text(),$(t).append($("<div/>").attr("id","site_saml").text(i+" ("+n.domain+")")))}},MSLogout.ThirdPartyCookieStates={NOT_LOADED:-1,DISABLED:0,ENABLED:1},ThirdPartyCookieStates=MSLogout.ThirdPartyCookieStates,MSLogin.OptIn={optin_cookie_name:"MSOptIn",optin_cookie_value:"newui",optin_button_id:"newui_optin_button",optin_label_id:"newui_optin_label",opted_in_button_text:"Opt out",opted_out_button_text:"Opt in",exp_container_label:"experiment_container",exp_status:0,optInNewUI:function(){Util.setCookie("MSOptIn",MSLogin.OptIn.optin_cookie_value,60),$("#"+MSLogin.OptIn.optin_button_id).html(MSLogin.OptIn.opted_in_button_text),$("#"+MSLogin.OptIn.optin_button_id).click(MSLogin.OptIn.optOutNewUI)},optOutNewUI:function(){Util.setCookie(MSLogin.OptIn.optin_cookie_name,"",0),$("#"+MSLogin.OptIn.optin_label_id).html(MSLogin.OptIn.opted_out_label_text),$("#"+MSLogin.OptIn.optin_button_id).html(MSLogin.OptIn.opted_out_button_text),$("#"+MSLogin.OptIn.optin_button_id).click(MSLogin.OptIn.optInNewUI)},saveStatus:function(){Util.setCookie(MSLogin.OptIn.optin_cookie_name,MSLogin.OptIn.exp_status,60)},toggleButton:function(n){var t=n.split("_")[1];$.each(Constants.OPTIN_FEATURE_EXPERIMENTS,function(n){if(n==t){var r=(parseInt(n)&MSLogin.OptIn.exp_status)>0,i=MSLogin.OptIn.opted_out_button_text;r?(MSLogin.OptIn.exp_status=MSLogin.OptIn.exp_status&~n,i=MSLogin.OptIn.opted_out_button_text):(MSLogin.OptIn.exp_status=MSLogin.OptIn.exp_status|n,i=MSLogin.OptIn.opted_in_button_text),$("#optin_"+n).html(i),MSLogin.OptIn.saveStatus()}})},drawExperiment:function(n,t){var r;if(n!=null&&n!=undefined){var n=parseInt(n),u=(n&MSLogin.OptIn.exp_status)>0,i=$("#"+MSLogin.OptIn.exp_container_label);i.append($("<div/>").addClass("bigtext").html(t[0])),i.append($("<div/>").addClass("status").addClass("normaltext").html(t[1])),r=MSLogin.OptIn.opted_out_button_text,u&&(r=MSLogin.OptIn.opted_in_button_text),i.append($("<span/>").addClass("button").addClass("bigtext").attr("id","optin_"+n).attr("tabindex","1").html(r).click(function(){MSLogin.OptIn.toggleButton("optin_"+n)})),i.append($("<br/>")),i.append($("<br/>")),i.append($("<br/>"))}},init:function(){if($("meta[name=PageID]").attr("content")=="optin.2.0"){User.UpdateBackground("",""),MSLogin.OptIn.exp_status=parseInt(Constants.FEATURE_SLOT_MASK);var n=parseInt(Util.getCookie(MSLogin.OptIn.optin_cookie_name));MSLogin.OptIn.exp_status=MSLogin.OptIn.exp_status|n,MSLogin.OptIn.drawOptinPanel(),$.each(Constants.OPTIN_FEATURE_EXPERIMENTS,function(n,t){MSLogin.OptIn.drawExperiment(n,t)}),$(".cred").css("padding-top","20px"),$(".cred").css("min-height",$(".login_cred_options_container").height()),$(".login_inner_container").css("display","inline-block")}},drawOptinPanel:function(){var n=$("<div/>").addClass("subtext").attr("id","experiment_container");$.each(MSLogin.OptIn.optin_messaging,function(t,i){return n.append($("<div/>").addClass("bigtext").html(i.headline)),n.append($("<div/>").addClass("status normaltext").html(i.text)),navigator.userAgent.match(/Android 2\.3/)?!1:void 0}),n.append($("<div/>").attr("id",MSLogin.OptIn.exp_container_label)),$(".login_cred_options_container").html(n)},optin_messaging:[{headline:"Windows Azure AD Sign-in Enhancements",text:"The Windows Azure AD team is continuously working to improve the sign-in experience to Office 365, Windows Azure and other Microsoft services used by organizations."},{headline:"",text:"From time to time, new features or capabilities may be released in Preview, allowing you to try them out and provide feedback before they become part of the mainline experience. These features are safe to try (you can easily revert to the mainline experience by opting out) but are not supported as part of the production service."},{headline:"How to test the new sign-in features",text:"Features that are available in Preview are listed below. You will need to opt in from each device you want to test the features with."}]},$(document).ready(function(){MSLogin.OptIn.init()}),PostType={INVALID:"0",PASSWORD:"11",FEDERATION:"13",SHA1_PASSWORD:"15",SHA1HASH_PASSWORD:"16"},LoginOption={EMPTY:"0",REMEMBER_PASSWORD:"1",REMEMBER_USER_TILE:"2",NOTHING_CHECKED:"3",OTHER_SAVED_USERS:"4",ACTIVE_USER:"5"},MSLogin.Post={DetermineBrowser:function(){return $.browser.msie?"MSIE":$.browser.chrome?"Chrome":$.browser.webkit?"Webkit":$.browser.safari?"Safari":$.browser.mozilla?"Firefox":$.browser.opera?"Opera":"Unknown"},IsSubmitReady:function(){var n=decodeURIComponent(Util.ExtractQSParam("nca")),t,i;switch(Context.username_state.home_realm_state){case Constants.State.FEDERATED:return!1;case Constants.State.MANAGED:break;case Constants.State.INVALID:break;case Constants.State.NONE:if(User.UpdateUsernameState(),!Context.username_state.is_empty&&!Context.username_state.is_partial&&n!="true"&&n!="1"&&!Constants.IS_NAME_COEXISTENCE_ACCOUNT)return User.RefreshDomainState(),!1;break;default:return!1}return Support.validateCredInputs()?(t=$("input#cred_userid_inputtext").val(),i=$("input#cred_password_inputtext").val(),t==""&&i=="",!0):!1},GetCredParameters:function(n){var t=[],f;if(Context.use_instrumentation&&n)try{var u=new Date,r=u.getTime()-u.getMilliseconds()-12e4,i=window.performance.timing;t.push({name:"n1",value:i.navigationStart-r}),t.push({name:"n2",value:i.redirectStart-r}),t.push({name:"n3",value:i.redirectEnd-r}),t.push({name:"n4",value:i.fetchStart-r}),t.push({name:"n5",value:i.domainLookupStart-r}),t.push({name:"n6",value:i.domainLookupEnd-r}),t.push({name:"n7",value:i.connectStart-r}),t.push({name:"n8",value:i.secureConnectionStart-r}),t.push({name:"n9",value:i.connectEnd-r}),t.push({name:"n10",value:i.requestStart-r}),t.push({name:"n11",value:i.responseStart-r}),t.push({name:"n12",value:i.responseEnd-r}),t.push({name:"n13",value:i.domLoading-r}),t.push({name:"n14",value:i.domInteractive-r}),t.push({name:"n15",value:i.domContentLoadedEventEnd-i.domContentLoadedEventStart}),t.push({name:"n16",value:i.domComplete-r}),t.push({name:"n17",value:i.loadEventStart-r}),t.push({name:"n18",value:i.loadEventEnd-r}),t.push({name:"n19",value:Instrument.home_realm_load_time}),t.push({name:"n20",value:Instrument.latency_sensitivity}),t.push({name:"n21",value:Instrument.prefetch_done?1:0}),t.push({name:"n22",value:Instrument.prefetch_load_time}),t.push({name:"n23",value:Instrument.background_image_loaded?1:0}),t.push({name:"n24",value:Instrument.background_image_load_time}),t.push({name:"n25",value:Tiles.users!=null?Tiles.users.length-1:0}),t.push({name:"n26",value:Instrument.email_discovery_ui_code}),t.push({name:"n27",value:Instrument.email_discovery_splitter_choice}),t.push({name:"n28",value:Instrument.possible_easi_user}),t.push({name:"n29",value:Instrument.tenant_branding_process_end_time-Instrument.tenant_branding_start_time}),t.push({name:"n30",value:Instrument.tenant_branding_json_end_time-Instrument.tenant_branding_start_time}),t.push({name:"n31",value:Instrument.tenant_branding_load_error?1:0}),t.push({name:"n32",value:Instrument.has_tenant_branding?1:0}),t.push({name:"n33",value:Instrument.has_dynamic_tenant_branding?1:0}),t.push({name:"n34",value:Instrument.logo_image_load_time}),t.push({name:"n35",value:Instrument.background_image_error?1:0}),t.push({name:"n36",value:Instrument.logo_image_error?1:0}),t.push({name:"n37",value:Instrument.tenant_branding_total_time}),t.push({name:"n38",value:Instrument.tenant_branding_number_of_switches}),t.push({name:"n39",value:Instrument.tenant_branding_right_side_time}),t.push({name:"n40",value:Instrument.logo_image_end_time}),t.push({name:"n41",value:Instrument.background_image_end_time}),t.push({name:"n42",value:Instrument.document_ready_end_time}),t.push({name:"n43",value:Instrument.document_load_end_time})}catch(e){}return t.push({name:"type",value:PostType.PASSWORD}),$("#cred_keep_me_signed_in_checkbox").attr("checked")?t.push({name:"LoginOptions",value:LoginOption.REMEMBER_PASSWORD}):Support.isUXFeatureEnabled(4096)&&EmailDiscovery.IsDiscoveryPage()||Context.post_from_tile?t.push({name:"LoginOptions",value:LoginOption.REMEMBER_USER_TILE}):t.push({name:"LoginOptions",value:LoginOption.NOTHING_CHECKED}),t.push({name:"NewUser",value:1}),t.push({name:"idsbho",value:1}),t.push({name:"PwdPad",value:""}),t.push({name:"sso",value:""}),f=decodeURIComponent(Util.ExtractQSParam("vv")),t.push({name:"vv",value:f}),t.push({name:"uiver",value:1}),t.push({name:"i12",value:window.location.protocol=="https:"?1:0}),t.push({name:"i13",value:Post.DetermineBrowser()}),t.push({name:"i14",value:$.browser.version}),t.push({name:"i15",value:Background.winW}),t.push({name:"i16",value:Background.winH}),Util.exists(HIP)&&HIP.data!=null&&t.push({name:"HIPSolution",value:HIP.getSolution()}),Constants.IS_CXH_REQUEST?t.push({name:"i20",value:Constants.IS_CXH_REQUEST}):t.push({name:"i20",value:""}),Context.redirect_to_manage&&$.each(t,function(n,t){t.name=="LoginOptions"&&(t.value="1"+t.value)}),t},SubmitCreds:function(){var n,t,i;if(Post.IsSubmitReady()){if($("#cred_password_inputtext").focus(),n=[],n=Post.GetCredParameters(Constants.SUBMIT_METRICS_ON_POST),Constants.IS_CXH_REQUEST&&typeof CloudExperienceHost!="undefined"&&typeof CloudExperienceHost.Bridge!="undefined")try{t=new CloudExperienceHost.Bridge,t.invoke("CloudExperienceHost.Storage.SharableData.addValue","oobe-username",$("input#cred_userid_inputtext").val()),t.invoke("CloudExperienceHost.Storage.SharableData.addValue","oobe-password",$("input#cred_password_inputtext").val()),n.push({name:"i21",value:""})}catch(r){n.push({name:"i21",value:r.message})}i=[],$.each(n,function(n,t){$.inArray(t.name,i)===-1&&t.value!=undefined&&($("<input />").attr("type","hidden").attr("name",t.name).attr("value",t.value).appendTo("#credentials"),i.push(t.name))}),$("form#credentials").submit()}},SubmitInstrumentation:function(){var n=[],t;n=Post.GetCredParameters(Constants.SUBMIT_METRICS_ON_REDIRECT),n.login="federated",n.passwd="",n.HIPSolution="",n.LoginOptions=LoginOption.NOTHING_CHECKED,t={},$.each(n,function(n,i){i.value!=undefined&&(t[i.name]=i.value)}),$.ajax({headers:{Accept:"application/json"},url:$("#credentials").attr("action")+"&clientMetrics&federatedDomain="+Context.federated_domain,type:"POST",dataType:"json",data:t,async:!0,timeout:200})}},Post=MSLogin.Post,MSStrongAuth={appendQPToURL:function(){if($("#switch_user_link").length!=0){var n=$("#switch_user_link").attr("href"),t=/^\d+$/;n=Util.AddQSParamIfNotExists(n,"id",t),n=Util.AddQSParamIfNotExists(n,"lc",t),n=Util.AddQSParamIfNotExists(n,"username",/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/),n=Util.AddQSParamIfNotExists(n,"ru"),n=Util.AddQSParamIfNotExists(n,"whr"),n=Util.AddQSParamIfNotExists(n,"wreply"),n=Util.AddQSParamIfNotExists(n,"wauth"),$("#switch_user_link").attr("href",n)}}},MSStrongAuth.ProofUp={doSubmit:function(){var n=$("#fmProofup").attr("action"),t=n.indexOf("?")==-1?"?":"&";$("#login_workload_logo_image").length>0&&($("#login_workload_logo_image").attr("src").toLowerCase().indexOf("office365")>=0?$("#fmProofup").attr("action",n+t+"BrandContextID=O365"):$("#login_workload_logo_image").attr("src").toLowerCase().indexOf("/azure/logo.png")>=0&&$("#fmProofup").attr("action",n+t+"BrandContextID=Azure")),document.fmProofup.submit()}},ProofUp=MSStrongAuth.ProofUp,MSStrongAuth.StrongAuthCheck={currentPoll:0,intervalId:0,enablePolling:1,authMethods:null,currentAuthMethod:null,currentAuthMethodId:"",authInProgress:0,endAuthInProgress:0,xhr:0,pollIntervalId:0,areValidMethodsPresent:function(n){if(n==null||n.length==0)return!1;for(i=0;i<n.length;i++)if(n[i].AuthMethodDeviceId!=null&&n[i].AuthMethodDeviceId!="")return!0;return!1},initAuthMethods:function(){$("#redirect_dots_animation").show(),$("#redirect_dots_animation").css("visibility","visible"),User.setupCredFieldsWithPlaceHolder(),setTimeout(User.startAnimation,0),StrongAuthCheck.intervalId=setInterval(User.startAnimation,Constants.TWOFA_ANIMATION_INTERVAL),StrongAuthCheck.authInProgress=1,StrongAuthCheck.initAuthSuccess(Constants.StrongAuth.Context)},beginAuthUsingMethod:function(n){StrongAuthCheck.currentAuthMethod=n,StrongAuthCheck.currentAuthMethodId=n.AuthMethodId,StrongAuthCheck.authInProgress=1;var t='{ "Method": "BeginAuth",  "flowToken": "'+Constants.StrongAuth.FlowToken+'",  "ctx": "'+Constants.StrongAuth.Ctx+'",  "AuthMethodId":"'+n.AuthMethodId+'"}';n.AuthMethodId.toUpperCase().indexOf("TWOWAYVOICE")==0?($(".tfa_results_text.30050").show(),$("#tfa_button_container").hide(),$("button#tfa_signin_button").prop("disabled",!0)):n.AuthMethodId.toUpperCase().indexOf("TWOWAYSMS")==0?$(".tfa_results_text.30049").show():n.AuthMethodId.toUpperCase().indexOf("PHONEAPPNOTIFICATION")==0&&$(".tfa_results_text.30051").show(),n.MethodDisplayString!="none"?($("#tfa_phone_text").text(n.MethodDisplayString),$("#tfa_phone_text").show(),$(".tile_secondary_name").show(),$(".tile_secondary_name").text(n.MethodDisplayString)):($("#tfa_phone_text").hide(),$(".tile_secondary_name").hide()),$("#tfa_options_link_container").show(),StrongAuthCheck.changeCredHeight(),StrongAuthCheck.beginAuth(t)},beginAuth:function(n){StrongAuthCheck.xhr=$.ajax({headers:{Accept:"application/json"},url:Constants.StrongAuth.SASControllerBeginAuthUrl,timeout:Constants.TWOFA_TIMEOUT,data:n,dataType:"json",type:"POST",contentType:"application/json",success:StrongAuthCheck.beginAuthSuccess,error:StrongAuthCheck.showUnknownError})},checkPolling:function(n){var t='{"Method":"EndAuth",  "SessionId":"'+n.SessionId+'",  "FlowToken":"'+n.FlowToken+'",  "Ctx":"'+n.Ctx+'",  "AuthMethodId":"'+n.AuthMethodId+'"}';StrongAuthCheck.enablePolling==1&&(StrongAuthCheck.currentPoll++,Constants.TWOFA_MAX_POLLS>=StrongAuthCheck.currentPoll?StrongAuthCheck.poll(t):StrongAuthCheck.showAuthTimeoutError(n))},poll:function(n){StrongAuthCheck.pollIntervalId=setTimeout(function(){StrongAuthCheck.xhr=$.ajax({headers:{Accept:"application/json"},url:Constants.StrongAuth.SASControllerEndAuthUrl,timeout:Constants.TWOFA_TIMEOUT,data:n,dataType:"json",type:"POST",contentType:"application/json",success:StrongAuthCheck.endAuthSuccess,error:StrongAuthCheck.showUnknownError})},Constants.TWOFA_POLLING_INTERVAL)},redirect:function(){},tryRedirect:function(){},showInitError:function(n){$(".tfa_results_text").hide(),$("#redirect_dots_animation").hide(),$(".tfa_error_text.30062").show(),StrongAuthCheck.showErrorInfo(n),clearInterval(StrongAuthCheck.intervalId)},showAuthError:function(n){if(StrongAuthCheck.authInProgress==1){var t="30062";switch(n.ResultValue){case"UserVoiceAuthFailedCallWentToVoicemail":t="30106";break;case"UserVoiceAuthFailedInvalidPhoneInput":case"UserVoiceAuthFailedPhoneHungUp":t="30107";break;case"UserVoiceAuthFailedInvalidPhoneNumber":case"UserVoiceAuthFailedInvalidExtension":case"InvalidFormat":t="30109";break;case"UserAuthFailedDuplicateRequest":case"UserVoiceAuthFailedPhoneUnreachable":case"UserVoiceAuthFailedProviderCouldntSendCall":t="30108";break;case"User2WaySMSAuthFailedProviderCouldntSendSMS":case"SMSAuthFailedProviderCouldntSendSMS":t="30434";break;case"User2WaySMSAuthFailedNoResponseTimeout":t="30435";break;case"SMSAuthFailedNoResponseTimeout":case"SMSAuthFailedWrongCodeEntered":case"OathCodeIncorrect":case"OathCodeDuplicate":case"OathCodeOld":t="30436";break;case"PhoneAppNoResponse":t="30437";break;case"User2WaySMSAuthFailedWrongCodeEntered":t="30438";break;case"PhoneAppInvalidResult":t="30439";break;case"PhoneAppDenied":t="30440";break;case"PhoneAppTokenChanged":t="30441"}StrongAuthCheck.currentAuthMethod==null?$(".tfa_results_text").hide():StrongAuthCheck.currentAuthMethod.AuthMethodId.toUpperCase().indexOf("ONEWAYSMS")==0?$(".tfa_results_text.30167").show():StrongAuthCheck.currentAuthMethod.AuthMethodId.toUpperCase().indexOf("PHONEAPPOTP")==0?$(".tfa_results_text.30166").show():$(".tfa_results_text").hide(),$("#redirect_dots_animation").hide(),$(".tfa_error_text."+t).show(),StrongAuthCheck.showErrorInfo(n),clearInterval(StrongAuthCheck.intervalId)}},showAuthTimeoutError:function(n){StrongAuthCheck.authInProgress==1&&(StrongAuthCheck.currentAuthMethod==null?$(".tfa_results_text").hide():StrongAuthCheck.currentAuthMethod.AuthMethodId.toUpperCase().indexOf("ONEWAYSMS")==0?$(".tfa_results_text.30167").show():StrongAuthCheck.currentAuthMethod.AuthMethodId.toUpperCase().indexOf("PHONEAPPOTP")==0?$(".tfa_results_text.30166").show():$(".tfa_results_text").hide(),$("#redirect_dots_animation").hide(),$(".tfa_error_text.30442").show(),StrongAuthCheck.showErrorInfo(n),clearInterval(StrongAuthCheck.intervalId),StrongAuthCheck.endAuthInProgress=0)},showUnknownError:function(n,t){if(StrongAuthCheck.authInProgress==1){if(StrongAuthCheck.currentAuthMethod==null?$(".tfa_results_text").hide():StrongAuthCheck.currentAuthMethod.AuthMethodId.toUpperCase().indexOf("ONEWAYSMS")==0?$(".tfa_results_text.30167").show():StrongAuthCheck.currentAuthMethod.AuthMethodId.toUpperCase().indexOf("PHONEAPPOTP")==0?$(".tfa_results_text.30166").show():$(".tfa_results_text").hide(),$("#redirect_dots_animation").hide(),t=="timeout"?$(".tfa_error_text.30442").show():$(".tfa_error_text.30062").show(),clearInterval(StrongAuthCheck.intervalId),StrongAuthCheck.endAuthInProgress=0,StrongAuthCheck.currentAuthMethod&&StrongAuthCheck.currentAuthMethod.SessionId){var i=StrongAuthCheck.errTemplate.format(StrongAuthCheck.currentAuthMethod.SessionId||"",StrongAuthCheck.currentAuthMethod.CorrelationId||"",(new Date).toISOString());$("#tfa_error_text").show(),$("#tfa_error_text").html(i)}StrongAuthCheck.changeCredHeight()}},initAuthSuccess:function(n){if(n.Result=="true"){if(StrongAuthCheck.authMethods=n,n.DefaultMethod==null){$(".tfa_error_text.30126").show();return}StrongAuthCheck.beginAuthUsingMethod(n.DefaultMethod)}},beginAuthSuccess:function(n){var t,i,r;n.Result=="true"?(StrongAuthCheck.FlowToken=n.FlowToken,StrongAuthCheck.Ctx=n.Ctx,StrongAuthCheck.currentAuthMethod.SessionId=n.SessionId,StrongAuthCheck.currentAuthMethod.CorrelationId=n.CorrelationId,t=!1,n.AuthMethodId.toUpperCase().indexOf("ONEWAYSMS")==0&&StrongAuthCheck.currentAuthMethodId&&StrongAuthCheck.currentAuthMethodId.toUpperCase().indexOf("ONEWAYSMS")==0?(i="30167",t=!0):n.AuthMethodId.toUpperCase().indexOf("PHONEAPPOTP")==0&&StrongAuthCheck.currentAuthMethodId&&StrongAuthCheck.currentAuthMethodId.toUpperCase().indexOf("PHONEAPPOTP")==0&&(i="30166",t=!0),t?(clearInterval(StrongAuthCheck.intervalId),$("#tfa_signin_button").show(),$("button#tfa_signin_button").prop("disabled",!1),$("input#tfa_code_inputtext").val(""),$("#redirect_dots_animation").hide(),$(".tfa_results_text").hide(),$(".tfa_results_text."+i).show(),$("#tfa_code_container").show(),$("#tfa_pin_container").length&&($("input#tfa_pin_inputtext").val(""),$("#tfa_pin_container").show(),$("input#tfa_pin_inputtext").keypress(function(n){User.KeyPressEnter(n,StrongAuthCheck.submitCode,13)})),$("#tfa_code_inputtext").focus(),$("#tfa_button_container").show(),$("input#tfa_code_inputtext").keypress(function(n){User.KeyPressEnter(n,StrongAuthCheck.submitCode,13)}),$("#tfa_signin_button").keypress(function(n){User.KeyPressEnter(n,StrongAuthCheck.submitCode,13)}),setTimeout(function(){var i=n.SessionId,t;StrongAuthCheck.currentAuthMethod.SessionId==i&&StrongAuthCheck.authInProgress&&$("input#tfa_code_inputtext").val().length==0&&($(".tfa_error_text.30442").show(),t=StrongAuthCheck.errTemplate.format(StrongAuthCheck.currentAuthMethod.SessionId||"",StrongAuthCheck.currentAuthMethod.CorrelationId||"",(new Date).toISOString()),$("#tfa_error_text").show(),$("#tfa_error_text").html(t),StrongAuthCheck.changeCredHeight())},Constants.TWOFA_AUTH_TIMEOUT),StrongAuthCheck.changeCredHeight()):(r='{ "Method":"EndAuth","SessionId":"'+n.SessionId+'","FlowToken":"'+n.FlowToken+'","Ctx":"'+n.Ctx+'", "AuthMethodId":"'+n.AuthMethodId+'"}',StrongAuthCheck.currentPoll=0,StrongAuthCheck.changeCredHeight(),StrongAuthCheck.poll(r))):StrongAuthCheck.showAuthError(n)},endAuthSuccess:function(n){if(StrongAuthCheck.currentAuthMethod.SessionId!=n.SessionId){StrongAuthCheck.showAuthError(n),StrongAuthCheck.endAuthInProgress=0;return}n.Result=="true"?StrongAuthCheck.processResult(n):n.Retry=="true"?StrongAuthCheck.checkPolling(n):(StrongAuthCheck.showAuthError(n),StrongAuthCheck.endAuthInProgress=0)},processResult:function(n){var t,i,r,u;StrongAuthCheck.enablePolling==1&&(t=document.createElement("form"),t.setAttribute("method","post"),t.setAttribute("action",Constants.StrongAuth.SASControllerProcessAuthUrl),i=document.createElement("input"),i.setAttribute("type","hidden"),i.setAttribute("name","request"),i.setAttribute("value",n.Ctx),t.appendChild(i),r=document.createElement("input"),r.setAttribute("type","hidden"),r.setAttribute("name","flowToken"),r.setAttribute("value",n.FlowToken),t.appendChild(r),u=document.createElement("input"),u.setAttribute("type","hidden"),u.setAttribute("name","mfaAuthMethod"),u.setAttribute("value",n.AuthMethodId),t.appendChild(u),document.body.appendChild(t),t.submit())},showOptions:function(){StrongAuthCheck.xhr&&StrongAuthCheck.xhr.abort(),clearInterval(StrongAuthCheck.pollIntervalId),clearInterval(StrongAuthCheck.intervalId),StrongAuthCheck.enablePolling=0,StrongAuthCheck.authInProgress=0,StrongAuthCheck.currentAuthMethodId="",$("#tfa_remember_my_device_container").hide(),$("#redirect_dots_animation").hide(),$(".tfa_results_text").hide(),$("#tfa_phone_text").hide(),$("#tfa_title_text").hide(),$(".tfa_error_text").hide(),$("#tfa_options_link_container").hide(),$("#tfa_code_container").hide(),$("#tfa_pin_container").hide(),$("#tfa_button_container").hide(),$("button#tfa_signin_button").prop("disabled",!0),$("#header_text").text(Constants.TWOFA_HEADER_TEXT_SELECTMETHOD),$("#tfa_client_side_error_text").hide(),$("#tfa_options_title_text").show(),$("#tfa_options_list").show(),$.each(StrongAuthCheck.authMethods.Methods,function(n,t){if(t.AuthMethodDeviceId!=null&&t.AuthMethodDeviceId!=""&&n<Constants.TWOFA_MAXMETHODS){$("#link"+n).text(t.MethodDisplayString);var i="javascript:StrongAuthCheck.beginAltAuth("+n+")";$("#link"+n).attr("href",i),$("#listItem"+n).show(),$("#link_icon"+n).removeClass("voice sms device"),t.AuthMethodId!=null&&t.AuthMethodId.indexOf("Voice")!=-1?$("#link_icon"+n).addClass("voice"):t.AuthMethodId!=null&&t.AuthMethodId.indexOf("SMS")!=-1?$("#link_icon"+n).addClass("sms"):$("#link_icon"+n).addClass("device")}})},beginAltAuth:function(n){$("#redirect_dots_animation").show(),$("#tfa_phone_text").show(),$("#tfa_title_text").show(),$(".tfa_error_text").show(),$("#tfa_options_link_container").show(),$(".tfa_error_text").hide(),$("#tfa_options_title_text").hide(),$("#tfa_options_list").hide(),$("#tfa_remember_my_device_container").show(),$("#header_text").text(Constants.TWOFA_HEADER_TEXT_PROTECTACCOUNT),StrongAuthCheck.enablePolling=1,StrongAuthCheck.endAuthInProgress=0,User.startAnimation(),StrongAuthCheck.intervalId=setInterval(User.startAnimation,Constants.TWOFA_ANIMATION_INTERVAL),StrongAuthCheck.beginAuthUsingMethod(StrongAuthCheck.authMethods.Methods[n])},submitCode:function(n){var n,t,i;($(".tfa_error_text").hide(),StrongAuthCheck.endAuthInProgress!=1)&&(n=$("input#tfa_code_inputtext").val(),n=$.trim(n),t="",$("#tfa_pin_container").length&&(t=$("input#tfa_pin_inputtext").val(),t=$.trim(t)),StrongAuthCheck.validateOTPPost(n,t))&&(n=n+t,StrongAuthCheck.endAuthInProgress=1,$("#tfa_client_side_error_text").hide(),i='{ "Method":"EndAuth", "FlowToken":"'+StrongAuthCheck.FlowToken+'", "SessionId":"'+StrongAuthCheck.currentAuthMethod.SessionId+'", "Ctx":"'+StrongAuthCheck.Ctx+'", "AuthMethodId":"'+StrongAuthCheck.currentAuthMethod.AuthMethodId+'", "AdditionalAuthData":"'+n+'"}',StrongAuthCheck.currentPoll=0,$("#redirect_dots_animation").show(),setTimeout(User.startAnimation,0),StrongAuthCheck.intervalId=setInterval(User.startAnimation,Constants.TWOFA_ANIMATION_INTERVAL),StrongAuthCheck.poll(i))},validateOTPPost:function(n,t){if(n.length!=Constants.TWOFA_OTP_MAX_LEN||Math.ceil(n)!=Math.floor(n)||$("#tfa_pin_container").length&&(t.length==0||Math.ceil(t)!=Math.floor(t))){$("#tfa_client_side_error_text").show();var i=StrongAuthCheck.errTemplate.format(StrongAuthCheck.currentAuthMethod.SessionId||"",StrongAuthCheck.currentAuthMethod.CorrelationId||"",(new Date).toISOString());return $("#tfa_error_text").show(),$("#tfa_error_text").html(i),StrongAuthCheck.changeCredHeight(),!1}return!0},showErrorInfo:function(n){var t=StrongAuthCheck.errTemplateWithErrorCode.format(n.ErrCode,n.SessionId||"",n.CorrelationId||"",(new Date).toISOString());$("#tfa_error_text").show(),$("#tfa_error_text").html(t),StrongAuthCheck.changeCredHeight()},changeCredHeight:function(){var n=$("#tfa_outer_list_container").height();$(".cred").css("min-height",n)}},StrongAuthCheck=MSStrongAuth.StrongAuthCheck,$(window).load(function(){if($("meta[name=PageID]").attr("content")=="strongauthcheck.2.0"){$("#redirect_dots_animation").show(),$("#redirect_dots_animation").css("visibility","visible"),User.setupCredFieldsWithPlaceHolder(),setTimeout(User.startAnimation,0),StrongAuthCheck.intervalId=setInterval(User.startAnimation,Constants.TWOFA_ANIMATION_INTERVAL);StrongAuthCheck.initAuthMethods('{ "Method":"GetAuthMethods","SessionId":"","ContextId": "","AuthMethodId":"" }')}}),$(document).ready(function(){($("meta[name=PageID]").attr("content")=="strongauthcheck.2.0"||$("meta[name=PageID]").attr("content")=="proofup.2.0")&&MSStrongAuth.appendQPToURL()}),MSLogin.TenantBranding={IsDynamicBrandingEnabled:function(){return Support.isUXFeatureEnabled(32768)&&TenantBranding.IsDynamicTenantBrandingSupported()},IsShowingDynamicBranding:function(){return TenantBranding.IsDynamicBrandingEnabled()&&Context.TenantBranding.enabled},IsShowingDynamicWorkloadBranding:function(){return TenantBranding.IsShowingDynamicBranding()&&Context.TenantBranding.workload_branding_enabled},IsShowingDynamicWhrBranding:function(){return TenantBranding.IsShowingDynamicBranding()&&Support.isDefined(Context.TenantBranding.whr_key)&&Context.TenantBranding.whr_key==Context.TenantBranding.key},HideAndRemoveSlideAnimation:function(n){n.hide(),n.removeClass("slide")},RefreshDomainState:function(n){TenantBranding.IsDynamicBrandingEnabled()&&Support.checkIfDomainsMatch(n,Context.TenantBranding.prev_user)&&Support.isDefined(Context.TenantBranding.key)&&(TenantBranding.IsShowingDynamicWhrBranding()?TenantBranding.PerformDynamicBranding(Context.TenantBranding.prev_key):TenantBranding.PerformDynamicBranding(Context.TenantBranding.key))},RemoveAllOldElements:function(){var t=$(".workload_text_old"),n;t.remove(),n=$(".workload_img_old"),n.hide(),n.remove(),$("#boiler_plate_old").remove(),Constants.DEFAULT_BOILERPLATE_TEXT!=undefined&&Constants.DEFAULT_BOILERPLATE_TEXT.length>0&&($("#boiler_plate_header").remove(),$("#boiler_plate").remove(),TenantBranding.AddBoilerPlateText(Constants.DEFAULT_BOILERPLATE_TEXT,Constants.DEFAULT_BOILERPLATE_HEADER))},ConfigureElementsForDelayedRemoval:function(){var n=$("#background_background_image").clone();n.attr("id","background_background_image_old").removeClass("slide"),$("#background_branding_container").prepend(n),$("#background_background_image").hide(),$(".workload_img").addClass("workload_img_old").removeClass("workload_img"),$(".workload_img_text").addClass("workload_text_old").removeClass("workload_text")},ResetOnLoadContext:function(){Background.background_resized=!1,Context.TenantBranding.has_logo=!1,Context.TenantBranding.has_background_img=!1,Context.on_load_image_background_loaded=!1,Logo.logo_image_loaded=!1},ResetDynamicBrandingContext:function(){typeof LoginTenantBranding=="undefined"||(Context.TenantBranding.prev_obj=LoginTenantBranding,LoginTenantBranding=null),Context.TenantBranding.prev_key=Context.TenantBranding.key,Context.TenantBranding.prev_user=Context.TenantBranding.user,Context.TenantBranding.applied=!1,Context.TenantBranding.has_logo=!1,Context.TenantBranding.has_background_img=!1},BackupWorkloadBranding:function(){if(!Context.TenantBranding.workload_branding_saved&&!Context.TenantBranding.default_page){Context.TenantBranding.workload_branding_saved=!0,Context.TenantBranding.workload_branding_illustration=$("#background_background_image").clone(),Context.TenantBranding.workload_branding_illustration_alt=$("#background_background_image").attr("alt"),Context.TenantBranding.workload_branding_logo=$("#login_workload_logo_image").clone(),Context.TenantBranding.workload_branding_logo_text=$("#login_workload_logo_text").clone(),Context.TenantBranding.workload_branding_logo_alt=$("#login_workload_logo_image").attr("alt"),Context.TenantBranding.workload_branding_color=$("html").css("background-color"),Context.TenantBranding.workload_branding_footer_height=$("#footer_links_container").height(),TenantBranding.BackupElementHeights();var n=Context.TenantBranding.cred_height;Context.TenantBranding.workload_branding_height=n}},ShouldShowWhrBranding:function(){return TenantBranding.IsShowingDynamicBranding()&&Support.isDefined(Context.TenantBranding.whr_key)?Context.TenantBranding.whr_key!=Context.TenantBranding.key||TenantBranding.IsShowingDynamicWorkloadBranding():!1},RemoveTenantBrandingAndApplyWorkload:function(){TenantBranding.IsDynamicBrandingEnabled()&&(Support.hideClientMessages(),Context.TenantBranding.enabled=!0,Support.isDefined(Context.TenantBranding.whr_key)?TenantBranding.ShouldShowWhrBranding()&&TenantBranding.PerformDynamicBranding(Context.TenantBranding.whr_key):TenantBranding.IsShowingDynamicWorkloadBranding()||TenantBranding.ApplyWorkloadBranding())},RemoveWorkloadBranding:function(){TenantBranding.BackupWorkloadBranding(),TenantBranding.ConfigureElementsForDelayedRemoval(),TenantBranding.ResetOnLoadContext()},PerformDynamicBranding:function(n){if(TenantBranding.IsDynamicBrandingEnabled()&&!Constants.FORCED_SIGN_IN){if(Context.TenantBranding.store.Get(n)==undefined&&(n=null),TenantBranding.IsShowingDynamicBranding()&&Context.TenantBranding.key!=null&&Context.TenantBranding.key==n&&!TenantBranding.IsShowingDynamicWorkloadBranding())return;Instrument.tenant_branding_getuserrealm_time=Instrument.home_realm_load_time,n!=undefined&&n!=null&&(Context.TenantBranding.key==null||TenantBranding.IsShowingDynamicWorkloadBranding())?(Context.TenantBranding.default_page=!1,Context.TenantBranding.enabled=!0,Instrument.has_dynamic_tenant_branding=!0,Instrument.tenant_branding_number_of_switches++,Util.debug_console("workload branding -> tenant branding"),TenantBranding.RemoveWorkloadBranding(),TenantBranding.GetBrandingInfo(n)):n!=undefined&&n!=null&&Context.TenantBranding.key!=null&&n!=Context.TenantBranding.key?(Instrument.has_dynamic_tenant_branding=!0,Instrument.tenant_branding_number_of_switches++,Context.TenantBranding.default_page=!1,Context.TenantBranding.enabled=!0,TenantBranding.ReplaceTenantBranding(n)):Context.TenantBranding.key!=null&&(n==undefined||n==null||n=="")&&(Instrument.has_dynamic_tenant_branding=!0,Instrument.tenant_branding_number_of_switches++,Context.TenantBranding.default_page=!1,Context.TenantBranding.enabled=!0,TenantBranding.ApplyWorkloadBranding())}},getTenantBrandingContext:function(n,t){var i={},r=[["BannerLogo",!0,Constants.DEFAULT_LOGO],["TileLogo",!0,""],["TileDarkLogo",!0,""],["Illustration",!0,Constants.DEFAULT_ILLUSTRATION],["BackgroundColor",!1,Constants.DEFAULT_BACKGROUND_COLOR],["CompanyName",!1,""],["UserIdLabel",!1,Constants.USERNAME_HINT_TEXT],["BoilerPlateText",!1,""],["KeepMeSignedInDisabled",!1,!1]];return $.each(r,function(r,u){var f=u[0],e=u[1];i[f]=n[t]!=undefined&&n[t][f]!=undefined&&n[t][f]!=""?n[t][f]:n["0"][f],(i[f]==null||i[f]==undefined)&&(i[f]=u[2]),e&&(i[f]=i[f].toLowerCase())}),i},formatTenantBrandingData:function(n){return result={},$.each(n,function(n,t){var i=t.Locale;i>=0&&(result[i]=t)}),result},processTenantBranding:function(n){n!=null&&(Instrument.has_tenant_branding=!0,n=TenantBranding.formatTenantBrandingData(n),Context.TenantBranding.info=n,Context.TenantBranding.info_context=TenantBranding.getTenantBrandingContext(n,Constants.LCID),TenantBranding.IsShowingDynamicBranding()||(TenantBranding.ShowBrandedBoilerPlate(),TenantBranding.UpdateLoginCtaText()),TenantBranding.ShowBrandedLogo(),TenantBranding.ShowBrandedIllustration(),Instrument.tenant_branding_process_end_time=Util.now())},BackupElementHeights:function(){Context.TenantBranding.footer_height_saved||(Context.TenantBranding.footer_height_saved=!0,Context.TenantBranding.footer_height=$("#footer_links_container").height()),Context.TenantBranding.cred_height_saved||(Context.TenantBranding.cred_height_saved=!0,Context.TenantBranding.cred_height=$(".cred").height())},AddBoilerPlateText:function(n,t){var r=$("<div/>").attr("id","boiler_plate_header").addClass("boilerplate_header").text(t),i;$(".boilerplate_header_location").before(r),i=$("<div/>").attr("id","boiler_plate").addClass("tinytext").text(n),$(".footer_inner_container").before(i)},ShowBrandedBoilerPlate:function(){var t,n;$("#boiler_plate").remove(),TenantBranding.BackupElementHeights(),$("#boiler_plate_header").remove(),t=Context.TenantBranding.info_context,TenantBranding.AddBoilerPlateText(t.BoilerPlateText||Constants.DEFAULT_BOILERPLATE_TEXT,t.BoilerPlateText!=null?Constants.BOILERPLATE_HEADER:Constants.DEFAULT_BOILERPLATE_HEADER),$("#boiler_plate").show(),TenantBranding.ShouldFadeInTenantBranding()&&($("#boiler_plate").removeClass("slide"),$("#boiler_plate").addClass("slide")),n=50+$("#boiler_plate").height()+40,$(".login_inner_container").css("margin-bottom","-"+n+"px"),$(".login_footer_container").height(n),$(".push").height(n)},ShowBrandedLogo:function(){var n=Context.TenantBranding.info_context,t=Constants.IS_CXH_REQUEST?Constants.USE_DARK_TILE_LOGO?n.TileDarkLogo||n.TileLogo:n.TileLogo:n.BannerLogo;t!=undefined&&t!=""&&(t+="?ts="+Context.tenant_branding_ts),User.UpdateLogo(t,Constants.DEFAULT_LOGO_ALT),$("#login_workload_logo_text").hide()},ShowBrandedIllustration:function(){var t=Context.TenantBranding.info_context,n=t.Illustration;n!=undefined&&n!=""&&(n+="?ts="+Context.tenant_branding_ts),User.UpdateBackground(n,t.BackgroundColor)},StoreBrandingInfo:function(n,t){Context.TenantBranding.store.Add(n,t)},GetBrandingInfo:function(n){Instrument.tenant_branding_start_time=Util.now(),Context.tenant_branding_ts="",Context.TenantBranding.key=n,Context.TenantBranding.default_page&&(Context.TenantBranding.default_key=n),Context.TenantBranding.applied=!0,Context.TenantBranding.workload_branding_enabled=!1;var t=Context.TenantBranding.store.Get(n);t!=undefined&&(LoginTenantBranding=t,TenantBranding.ApplyTenantBranding())},ApplyTenantBranding:function(){typeof LoginTenantBranding!="undefined"&&(Instrument.tenant_branding_json_end_time=Util.now(),Context.TenantBranding.store.Add(Context.TenantBranding.key,LoginTenantBranding),Constants.TENANT_BRANDING=LoginTenantBranding),Constants.TENANT_BRANDING!=null&&Constants.TENANT_BRANDING!=""&&(clearInterval(Context.tenant_branding_tid),Context.tenant_branding_tid=null,TenantBranding.processTenantBranding(Constants.TENANT_BRANDING))},ReplaceTenantBranding:function(n){TenantBranding.RemoveTenantBrandingDelayed(),TenantBranding.GetBrandingInfo(n)},RemoveTenantBrandingDelayed:function(){var u=$("#tenantbrandingscript"),n,t,i,r;u!=undefined&&u!=null&&u.remove(),n=$(".workload_img_old"),n!=undefined&&n!=null&&n.remove(),n=$(".workload_img"),n!=undefined&&n!=null&&n.addClass("workload_img_old").removeClass("workload_img"),t=$(".workload_text"),t!=undefined&&t!=null&&t.addClass("workload_text").removeClass("workload_text_old"),i=$("#boiler_plate"),i!=undefined&&i!=null&&i.attr("id","boiler_plate_old"),r=$("#background_background_image").clone(),r.removeClass("slide"),r.attr("id","background_background_image_old"),$("#background_branding_container").prepend(r),$("#background_background_image").hide(),TenantBranding.ResetDynamicBrandingContext(),TenantBranding.ResetOnLoadContext(),TenantBranding.showKmsi(),TenantBranding.replaceUsernameHint()},RemoveTenantBranding:function(){var r=$("#tenantbrandingscript"),n,i,t;r!=undefined&&r!=null&&r.remove(),n=$(".workload_img_old"),n!=undefined&&n!=null&&n.remove(),n=$(".workload_img"),n!=undefined&&n!=null&&n.remove(),i=$(".workload_img_text"),i!=undefined&&i!=null&&i.remove(),t=$("#boiler_plate"),t!=undefined&&t!=null&&(Constants.DEFAULT_BOILERPLATE_TEXT.length>0?($("#boiler_plate_header").text(Constants.DEFAULT_BOILERPLATE_HEADER),t.text(Constants.DEFAULT_BOILERPLATE_TEXT)):t.remove(),$(".login_inner_container").css("margin-bottom","-50px"),$(".push").height(50)),$("#background_background_image").remove(),TenantBranding.ResetDynamicBrandingContext(),TenantBranding.ResetOnLoadContext(),TenantBranding.showKmsi(),TenantBranding.replaceUsernameHint()},ApplyWorkloadBranding:function(){if(Context.TenantBranding.workload_branding_enabled=!0,!Context.TenantBranding.workload_branding_saved||Context.TenantBranding.default_page)TenantBranding.RemoveTenantBrandingDelayed(),User.UpdateLogo(Constants.DEFAULT_LOGO,Constants.DEFAULT_LOGO_ALT),User.UpdateBackground(Constants.DEFAULT_ILLUSTRATION,Constants.DEFAULT_BACKGROUND_COLOR),$("#background_background_image").show(),Background.background_resized=!1,Context.on_load_image_background_loaded=!1,Logo.logo_image_loaded=!1;else{TenantBranding.RemoveTenantBranding(),Support.isDefined(Context.TenantBranding.workload_branding_illustration)&&$("#background_branding_container").prepend(Context.TenantBranding.workload_branding_illustration.clone()),Support.isDefined(Context.TenantBranding.workload_branding_logo)&&$(".login_workload_logo_container").append(Context.TenantBranding.workload_branding_logo.clone()),Support.isDefined(Context.TenantBranding.workload_branding_logo_text)&&$(".login_workload_logo_container").append(Context.TenantBranding.workload_branding_logo_text.clone()),User.RegisterOnLoadImage();var n=Context.TenantBranding.footer_height;n>0&&($("#footer_links_container").css("height",n+"px"),$("#footer_links_container").css("margin-top","-"+n+"px")),$("#background_page_overlay").css("background-color",Constants.DEFAULT_BACKGROUND_COLOR),$("#background_background_image").css("background-color",Constants.DEFAULT_BACKGROUND_COLOR),$("#background_branding_container").css("background-color",Constants.DEFAULT_BACKGROUND_COLOR),$("html").css("background-color",Constants.DEFAULT_BACKGROUND_COLOR),$("#background_background_image").removeClass("slide"),$(".workload_img").removeClass("slide"),$(".workload_img_text").removeClass("slide"),$("#background_background_image").hide(),$("#background_background_image").show(),$("#background_page_overlay").hide(),$(".workload_img").show(),$(".workload_img_text").show(),$("#background_background_image").addClass("slide"),$(".workload_img").addClass("slide"),$(".workload_img_text").addClass("slide"),Background.background_resized=!0,Context.on_load_image_background_loaded=!0,Logo.logo_image_loaded=!0}Context.TenantBranding.cred_height&&$(".cred").css("min-height",Context.TenantBranding.cred_height),Support.isDefined(Context.TenantBranding.workload_branding_login_cta_text)&&$("#login_cta_text").text(Context.TenantBranding.workload_branding_login_cta_text)},ShouldFadeInTenantBranding:function(){return TenantBranding.IsDynamicBrandingEnabled()&&(Context.TenantBranding.key!=null||Context.TenantBranding.workload_branding_saved)&&!Context.TenantBranding.default_page},UpdateLoginCtaText:function(){var t,i,n;$("meta[name=PageID]").attr("content")=="i5030.2.0"&&((Context.TenantBranding.workload_branding_login_cta_text==""||Context.TenantBranding.workload_branding_login_cta_text==null)&&(Context.TenantBranding.workload_branding_login_cta_text=$("#login_cta_text").text()),t=$(".workload_img"),i=!1,Support.isDefined(t)&&(n=null,n=t.attr("src"),Support.isDefined(n)&&Support.isDefined(Constants.DEFAULT_LOGO)&&(i=n.toLowerCase().indexOf(Constants.DEFAULT_LOGO.toLowerCase())>-1)),Constants.DYNAMIC_BRANDING_CTA_ENABLED&&!i&&$("#login_cta_text").text(Constants.PARTNER_NAME))},onLoadLogoHelper:function(){var n,t;Logo.logo_image_loaded=!0,n=$(".workload_img"),TenantBranding.HideAndRemoveSlideAnimation(n),t=$(".workload_text"),TenantBranding.HideAndRemoveSlideAnimation(t),Context.TenantBranding.has_logo?(n.show(),Instrument.logo_image_loaded=!0):(t.show(),Instrument.logo_image_loaded=!1),Instrument.logo_image_load_time=Util.now()-Instrument.logo_image_start,Instrument.tenant_branding_right_side_time=Util.now()-Instrument.tenant_branding_start_time,TenantBranding.RemoveAllOldElements(),TenantBranding.IsShowingDynamicWorkloadBranding()||TenantBranding.ShowBrandedBoilerPlate(),TenantBranding.UpdateLoginCtaText(),TenantBranding.ShouldFadeInTenantBranding()&&(n.addClass("slide"),t.addClass("slide")),Context.on_load_image_background_loaded?TenantBranding.onLoadImageHelper():($("#background_background_image_old").hide().remove(),background_color=Context.TenantBranding.background_color,$("#background_page_overlay").css("background-color",background_color),$("#background_branding_container").css("background-color",background_color),$("html").css("background-color",background_color),$("#background_background_image").css("background-color",background_color),$("#background_background_image").hide()),TenantBranding.setUserIdHintAndKmsi(),Util.debug_console("onLoadLogo: Logo successfully loaded.")},setUserIdHintAndKmsi:function(){Context.TenantBranding.info_context!=null&&(Context.TenantBranding.info_context.KeepMeSignedInDisabled&&Context.TenantBranding.kmsi_checkbox_hidden==!1&&!TenantBranding.IsShowingDynamicWorkloadBranding()?($("#cred_kmsi_container").hide(),$("#cred_keep_me_signed_in_checkbox").attr("checked",!1),$("#cred_sign_in_button").addClass("cred_sign_in_button_push"),Context.TenantBranding.kmsi_checkbox_hidden=!0):TenantBranding.showKmsi(),Context.TenantBranding.info_context.UserIdLabel==null||Context.TenantBranding.info_context.UserIdLabel.length==0||TenantBranding.IsShowingDynamicWorkloadBranding()?TenantBranding.replaceUsernameHint():(TenantBranding.setUsernameHint(Context.TenantBranding.info_context.UserIdLabel),Context.TenantBranding.username_hint_changed=!0))},showKmsi:function(){Context.TenantBranding.kmsi_checkbox_hidden&&($("#cred_kmsi_container").show(),$("#cred_sign_in_button").removeClass("cred_sign_in_button_push"),Context.TenantBranding.kmsi_checkbox_hidden=!1)},replaceUsernameHint:function(){Context.TenantBranding.username_hint_changed&&(TenantBranding.setUsernameHint(Constants.USERNAME_HINT_TEXT),Context.TenantBranding.username_hint_changed=!1)},setUsernameHint:function(n){Support.is_placeholder_supported()?$("#cred_userid_inputtext").attr("placeholder",n):$("#cred_userid_inputtext_placeholder_span").text(n),$("#cred_userid_inputtext").attr("alt",n)},onLoadImageHelper:function(){var t,i,n;Logo.logo_image_loaded&&(Instrument.tenant_branding_total_time=Util.now()-Instrument.tenant_branding_start_time,t=$("#background_background_image"),i=$("#background_page_overlay"),TenantBranding.HideAndRemoveSlideAnimation(t),$("#background_background_image_old").remove(),i.css("visibility","visible"),n=$("html").css("background-color"),n=Context.TenantBranding.background_color,i.css("background-color",n),$("#background_branding_container").css("background-color",n),$("html").css("background-color",n),Context.TenantBranding.has_background_img&&(t.show(),TenantBranding.ShouldFadeInTenantBranding()&&t.addClass("slide"),t.css("background-color",n),i.css("z-index","-1"),i.hide()),Util.debug_console("TenantBranding OnLoadImage: Background was resized."))},onLoadImageError:function(){TenantBranding.IsShowingDynamicBranding()&&(Context.TenantBranding.has_background_img=!1)},onLoadLogo:function(){var n=$("#login_workload_logo_image");Util.debug_console("onLoadLogo: Called"),!Logo.logo_image_loaded&&User.IsImageLoaded(n)&&TenantBranding.onLoadLogoHelper()},onLoadErrorLogo:function(){if(!Logo.logo_image_loaded){User.UpdateLogo("",Constants.DEFAULT_LOGO_ALT);var n=$(".workload_img_old");n.hide(),n.remove(),Logo.logo_image_loaded=!0,Instrument.logo_image_error=!0}},IsDynamicTenantBrandingSupported:function(){return Context.TenantBranding.browser_supports_dynamic_checked?Context.TenantBranding.browser_supports_dynamic:(Context.TenantBranding.browser_supports_dynamic=Support.CheckIfBrowserIsSupported(Constants.DYNAMIC_BRANDING_APPROVED_BROWSERS),Context.TenantBranding.browser_supports_dynamic_checked=!0,Context.TenantBranding.browser_supports_dynamic)},RestoreDefaultPageBranding:function(){typeof Constants.DEFAULT_BRANDING!="undefined"?Context.TenantBranding.applied&&Context.TenantBranding.key==Constants.DEFAULT_BRANDING||TenantBranding.GetBrandingInfo(Constants.DEFAULT_BRANDING):TenantBranding.RemoveTenantBrandingAndApplyWorkload()}},TenantBranding=MSLogin.TenantBranding,users=null,MSLogin.Tiles={tile_showing_user_cred:!0,users:null,cred_length_resized:!1,showUser:function(n,t,i){Tiles.tile_showing_user_cred||($("#login_user_chooser table").hide(),$(".login_cta_container").css("visibility","visible"),$("#login_cta_text").show(),$("#tiles_cta_text").hide(),Tiles.updateFirstUserTile(n,t,i),$("#login_user_chooser table:first").show(),$.each(users,function(r,u){u.login.toLowerCase()==n.toLowerCase()&&(u.isLive===t||u.domainHint===i)&&(u.authUrl==""&&(u.domainHint==""||typeof u.domainHint=="undefined")?Tiles.showManagedTileUser(u):Tiles.showFederatedTileUser(u))}),Context.back_action_stack.AddAction(Constants.CancelAction.FROM_SHOW_USER_TO_TILES),Tiles.tile_showing_user_cred=!0)},hideDisambiguationScreen:function(){$("#splitter-tiles-container").hide(),$("#cred_kmsi_container").show(),$("#cred_sign_in_button").show(),$("#cred_cancel_button").hide(),$("#recover_container").show(),$("#alternative-identity-providers").show(),$(".login_splitter_control").hide(),$("#splitter-tiles-container").children("a").remove(),$("#splitter-tiles-container").hide(),$("#login_user_chooser").empty(),$(".login_user_chooser").hide(),$("#login_user_chooser").hide(),$("#create_msa_account_container").hide()},showUserLoginPage:function(){$(".login_user_chooser").show(),$("#cta_error_message_text").show(),$("div.progress").css("visibility","hidden"),clearInterval(Context.animationTid),Support.hideClientErrorMessages(),Support.hideClientMessages(),Context.username_state.home_realm_state=Constants.State.NONE,Context.username_state.last_checked_email=Context.username_state.last_checked_email||"",$(".cta_message_text").show(),$("#cred_userid_container").show(),$("#cred_userid_inputtext").show(),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),$("#cred_userid_inputtext").focus()},showManagedTileUser:function(n){Tiles.disableActiveTile(),Context.post_from_tile=!0,$(".login_cred_container").show(),$(".login_cred_field_container").show(),$(".login_cred_container li").show(),$("#signin_legend").hide(),$("#cred_userid_inputtext").val(n.login),$("#cred_password_container").show(),$(".login_cred_options_container").show(),Context.username_state.enable_guests=!1,$("#guest_hint_text").hide(),$(".guest_redirect_container").hide(),Tiles.isUseOtherAccountVisible()||User.isChxOrAdalOverride()?$("#cred_cancel_button").show():$("#cred_cancel_button").hide(),Support.isUXFeatureEnabled(4096)&&($("meta[name=PageID]").attr("content")=="EmailBasedDiscovery.2.0"||$("meta[name=PageID]").attr("content")=="EmailBasedDiscoveryTiles.2.0")&&($("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),EmailDiscovery.is_enabled_workflow=!0),$("#cred_sign_in_button").show(),$("#cred_password_inputtext").focus(),User.RefreshDomainState(),Tiles.isUseOtherAccountVisible()||User.isChxOrAdalOverride()||$("#cred_cancel_button").hide()},showFederatedTileUser:function(n){Context.username_state.home_realm_state=Constants.State.FEDERATED,Context.post_from_tile=!0,Tiles.disableActiveTile(),$("#cred_userid_inputtext").val(n.login),$(".login_cred_field_container").show(),$(".login_cred_options_container").show(),$(".login_cred_options_container div.subtext").hide(),$("#cred_sign_in_button").hide(),$("#forget_tile_container").show(),$("#cred_password_container").hide(),$(".login_cta_container").hide(),$("#recover_container").hide(),$("#redirect_cta_text").show(),$("input#cred_password_inputtext").hide(),$("#redirect_company_name_text").html(""),$("#cred_kmsi_container").show(),$("#alternative-identity-providers").hide(),$("div.progress").css("visibility","visible"),User.startAnimation(),Context.animationTid=setInterval(User.startAnimation,3500),Context.username_state.enable_progress_bar=!0,Context.username_state.enable_redirect=!0,Context.username_state.enable_guests=!1,Support.isUXFeatureEnabled(4096)&&($("meta[name=PageID]").attr("content")=="EmailBasedDiscovery.2.0"||$("meta[name=PageID]").attr("content")=="EmailBasedDiscoveryTiles.2.0")&&($("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),EmailDiscovery.is_enabled_workflow=!0),Util.updateRedirectionMessage(n.authUrl),Context.redirect_auth_url=n.authUrl,Context.redirect_target=User.addFederatedRedirectQSParameters(n.authUrl),User.UsernameOnChangeHandler(),User.StartRedirection(!1)},disableActiveTile:function(){$("#login_user_chooser .tile_link:first .user_tile").addClass("disabled_tile"),$("#login_user_chooser .tile_link:first").addClass("disabled_tile"),$("#login_user_chooser .tile_link:first").attr("tabindex","-1"),$("#login_user_chooser .tile_link:first tr").css("cursor","default"),$(".tile_primary_name").css("cursor","default"),$(".tile_secondary_name").css("cursor","default")},enableActiveTile:function(){$("#login_user_chooser .tile_link:first .user_tile").removeClass("disabled_tile"),$("#login_user_chooser .tile_link:first").removeClass("disabled_tile"),$("#login_user_chooser .tile_link:first").attr("tabindex","1"),$("#login_user_chooser .tile_link:first tr").css("cursor","pointer"),$(".tile_primary_name").css("cursor","pointer"),$(".tile_secondary_name").css("cursor","pointer")},showOtherOption:function(){if(!Tiles.tile_showing_user_cred){if($("#alternative-identity-providers").show(),EmailDiscovery.IsTilesModeActivated()||EmailDiscovery.ShouldPerformDiscovery()){Tiles.tile_showing_user_cred=!0,Context.back_action_stack.AddAction(Constants.CancelAction.FROM_EMAILDISCOVERY_START_TO_TILES),EmailDiscovery.Init(),$("#cred_userid_inputtext").val("");return}Context.back_action_stack.AddAction(Constants.CancelAction.FROM_SHOW_USER_TO_TILES),Context.username_state.enable_progress_bar=!0,User.UsernameOnChangeHandler(),$(".login_cred_container").show(),$(".login_cred_container .windows_cred_block").show(),$(".login_cred_field_container").addClass("show_other"),$(".login_cred_field_container").show(),$("#cred_userid_container").show(),$("#login_user_chooser").hide(),$(".login_cred_options_container").show(),$(".login_cta_container").css("visibility","visible"),$("#login_cta_text").show(),$("#tiles_cta_text").hide(),$("#forget_tile_container").hide(),$("#cred_sign_in_button").show(),$("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),$("#cred_userid_inputtext").val(""),$("#cred_userid_inputtext").focus(),Context.username_state.enable_guests=!0,Tiles.tile_showing_user_cred=!0,Support.renderBrowserSpecific(),Tiles.isUseOtherAccountVisible()||User.isChxOrAdalOverride()?$("#cred_cancel_button").show():$("#cred_cancel_button").hide()}},CancelTileRedirect:function(){Context.redirect_to_manage=!1,Constants.IS_CXH_REQUEST||Constants.IS_ADAL_REQUEST||$("#cred_kmsi_container").show(),$("#cred_password_inputtext").val(""),Context.username_state.last_checked_email="",Tiles.enableActiveTile(),$("#cred_password_inputtext").val(""),$("#cta_error_message_text").remove(),Constants.DEFAULT_CTA_MESSAGE!="",$(".login_cred_field_container").removeClass("show_other"),$(".login_cred_field_container").hide(),$(".login_cred_options_container").hide(),$(".login_userid_container").hide(),$(".login_cred_options_container div.subtext").show(),$("#create_msa_account_container").hide(),$("#cred_sign_in_button").show(),$("#cred_kmsi_container").show(),$("#forget_tile_container").show(),Tiles.tile_showing_user_cred=!1,Support.hideClientErrorMessages(),User.CancelRedirect(),$("#login_user_chooser").html(""),Tiles.drawUsers()},getStringTileID:function(n,t){var i;if(n.id==undefined){for(i=n.login.replace("@","_");i.indexOf(".")>0;)i=i.replace(".","_");while(i.indexOf(" ")>0)i=i.replace(" ","_");while(i.indexOf("'")>0)i=i.replace("'","_");(n.isLive||n.domainHint==="msa")&&(i+="-live"),t&&(i="use_another_account"),i=i.toLowerCase()}else i=n.id;return i},drawTile:function(n,t,i){var o=n.name,f=n.login,a=n.name,s=n.login,h=null,c=null,v,y;n.isLive?(h=Constants.MSA_ACCOUNT_TILE_ALT_TEXT.replace("{0}",n.name),c=Constants.MSA_ACCOUNT_IMG_ALT_TEXT):(h=Constants.AAD_ACCOUNT_TILE_ALT_TEXT.replace("{0}",n.name),c=n.domainHint?n.domainHint:Constants.AAD_ACCOUNT_IMG_ALT_TEXT),v=n.sessionID?n.sessionID:"",o===""&&f!==""&&(o=f,a=s,f=s=""),o.toLowerCase()==f.toLowerCase()&&(f=s=""),y=n.ignore_length==undefined||n.ignore_length==!1,(!y||o.length<Constants.MAX_TILE_TEXT_LENGTH)&&(a=""),(!y||f.length<Constants.MAX_TILE_TEXT_LENGTH*1.6)&&(s="");var p="javascript:void(0)",r="",u="",e=null;$("meta[name=PageID]").attr("content").indexOf("reauth")>=0?(p="",r="<div/>",u="alt"):n.isWindows?(r="<a />",u="href",e=function(){WindowsBrowserSso.LoginWindowsUser(n.link)}):Context.email_discovery_mode?(r="<a/>",u="href",e=n.isLive?function(){Context.email_discovery_easi_user=!0,Instrument.email_discovery_splitter_choice=EmailDiscovery.WorkflowStates.MSA,EmailDiscovery.LoginMSOAccount()}:function(){Instrument.email_discovery_splitter_choice=EmailDiscovery.WorkflowStates.AAD,EmailDiscovery.LoginAADAccount()},h=n.name,c=n.name):n.link=="other"?(r="<a/>",u="href",e=Tiles.showOtherOption,h=n.name,c=n.name):n.isSigned?(r="<a />",u="href",e=function(){var t=Constants.BASE_URL+$.param({sessionId:n.sessionID,ctx:Constants.CONTEXT});User.Redirect(t)}):n.link!=""?(r="<a/>",u="href",e=function(){Tiles.showUser(n.link,n.isLive,n.domainHint)}):(p="",r="<div/>",u="alt");var w=n.link=="other"||Context.email_discovery_mode||p===""||i||!1,l=Tiles.getStringTileID(n,w),b=this.generateUserTileHtml(l,v,t,c,o,a,f,s,w?null:n.isSigned?n.isWindows?Constants.CONNECTEDTOWINDOWS:Constants.SIGNEDIN:Constants.CLICKTOSIGNIN,w||n.isWindows||Constants.IS_LOGOUT_REQUEST?null:n.isSigned?"signedin":"signedout");return $("#login_user_chooser").append($(r).attr("id",l+"_link").attr("data-session-id",v).attr(u,"#").attr("tabindex","1").addClass("tile_link").addClass("tooltip").attr("aria-label",h).click(e).append(b)),$("#"+l+"_menulink").keydown(function(n){var t=$(this).attr("data-ref"),i=$("#"+t+"-dropdown");switch(n.which){case 32:case 13:$(this).click(),n.preventDefault();break;case 27:i.hide()}}).click(function(n){var r;n.preventDefault(),n.stopPropagation();var u=$(this).attr("data-ref"),f=$(this).attr("data-session-id"),t=$("#"+u+"-dropdown"),i=$(".dropdownPanel");if(t.is(":visible"))i.hide();else{r=$(this).position(),i.hide(),t.removeClass("hidden").removeAttr("aria-hidden").css({left:r.left-t.width()+20+"px",top:r.top+15+"px"}).show(),t.find("li").removeAttr("aria-hidden").attr("data-session-id",f).show();$("html").one("click",function(){i.hide()})}}),l+"_link"},drawUsers:function(){Tiles.users||(Tiles.users=users=[]),Tiles.users.length>1||Tiles.users.length===1&&Tiles.users[0].link!="other"?($(".login_cta_container").css("visibility","visible"),$("#login_cta_text").hide(),$("#tiles_cta_text").show(),$(".login_cred_container li").hide(),$(".login_cred_container .windows_cred_block").hide(),$("#login_user_chooser").show(),$("#cred_userid_container").hide(),$("#switch_user_container").hide(),Tiles.drawUserTiles()):Tiles.showOtherOption()},drawUserTiles:function(){var n,t;Tiles.cred_length_resized=!0,n="",$.each(users,function(t,i){var r,u;n=Tiles.getUserImage(i),r="",(i.link=="other"||t<Constants.MAX_USER_TILES||Context.email_discovery_mode)&&(u=!Constants.IS_MSA_SUPPORTED&&i.isLive,r=Tiles.drawTile(i,n,u)),r!=""&&t==0&&$("#"+r).focus()}),Tiles.tile_showing_user_cred=!1,Context.username_state.enable_guests=!0,User.moveFooterToBottom(),Tiles.cred_length_resized||(t=$(".cred").height(),t+=$(".login_user_chooser").height(),$(".cred").css("min-height",t),Tiles.cred_length_resized=!0),Support.renderBrowserSpecific(),Context.TenantBranding.cred_height?$(".cred").css("min-height",Context.TenantBranding.cred_height):$(".cred").css("min-height","")},forgetAccount:function(){Tiles.tile_showing_user_cred=!1,$("#forget_tile_container").hide(),$("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),$(".login_cta_container").css("visibility","visible"),$("#login_cta_text").show(),$("#tiles_cta_text").hide(),Util.eraseCookie("MSPPre"),Tiles.CancelTileRedirect(),Tiles.showOtherOption(),$("#cred_cancel_button").hide()},forceSignIn:function(n){var t,i;Tiles.disableActiveTile(),Tiles.tile_showing_user_cred=!1,$("#login_cta_text").show(),$("#tiles_cta_text").hide(),$("#login_user_chooser table").hide(),$("#login_user_chooser table:first").show(),$("#switch_user_container").show(),t=null,$.each(users,function(i,r){r.login.toLowerCase()!=n.toLowerCase()||r.isLive||typeof r.domainHint!="undefined"&&r.domainHint!=""||(Tiles.showManagedTileUser(r),t=r)}),$("#cred_cancel_button").hide(),$("#forget_tile_container").hide(),i=!1,t!=null&&t.isLive!=null&&Tiles.ApplyToEachSavedUsers(function(r){r[0].length!=0&&r[0].toLowerCase()==n.toLowerCase()&&r[1]==(t.isLive?"1":"0")&&(i=!1)}),i?$("#cred_keep_me_signed_in_checkbox").attr("checked","checked"):$("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),$(".login_cta_container").show()},hasUserNameQS:function(){var n=Util.ExtractQSParam("username")+Util.ExtractQSParam("login_hint");return n!=""},showUserName:function(){var n=Util.ExtractQSParam("username"),t,i;n==""&&(n=Util.ExtractQSParam("login_hint")),n=decodeURIComponent(n),t=null,i=!1,$.each(Tiles.users,function(r,u){u.login.toLowerCase()!=n.toLowerCase()||i||(i=!0,t=u)}),i?(Tiles.showUser(n,t.isLive,t.domainHint),$("#cred_password_inputtext").focus()):(Tiles.showOtherOption(),$("#cred_userid_inputtext").val(n),$("#cred_userid_inputtext").focus())},showIsNotMe:function(n,t,i){Tiles.drawUsers(),Tiles.showUser(n,t,i),$(".login_cred_container li").hide(),$("#login_user_chooser").show("slow"),$(".login_cta_container").show(),$(".login_cta_container").css("visibility","visible"),$(".login_cred_options_container").show(),$(".login_cred_options_container div.subtext").hide(),$("#submit_button").hide(),$("#continue_as_user_container").show(),$("#continue_as_user_link").focus(),$("#switch_user_container").show()},updateContinueAsUserUrl:function(n){var t=$("#continue_as_user_link").attr("href");t=t.replace("post.srf","secure.srf"),t=t.replace(new RegExp("username=[^\\&]*","gm"),""),t.indexOf("msoptin-newui")<0&&(t+="&msoptin-newui"),$("#continue_as_user_link").attr("href",t),t=Util.ExtractQSParam("ru"),t!=""&&(t=n,$("#continue_as_user_link").attr("href",t))},forgetUserFromCookie:function(n,t){var i,u,f,r;if(Tiles.tile_showing_user_cred=!1,$("#forget_tile_container").hide(),$("#cred_keep_me_signed_in_checkbox").removeAttr("checked"),$(".login_cta_container").css("visibility","visible"),$("#login_cta_text").show(),$("#tiles_cta_text").hide(),$("#login_userid_inputtext").val(""),$("#login_password_inputtext").val(""),Tiles.CancelTileRedirect(),TenantBranding.RemoveTenantBrandingAndApplyWorkload(),i=[],Tiles.ApplyToEachSavedUsers(function(r){(r[0].length==0||r[0].toLowerCase()!=n.toLowerCase()||r[1]!=Number(t).toString())&&i.push([r[0],r[1],r[2]])}),u=Util.getCookie(Constants.PREFILL_USER_COOKIE),i.length==0){Util.eraseCookie(Constants.SAVED_USER_COOKIE),EmailDiscovery.IsTilesModeActivated()&&(Context.email_discovery_tiles_mode=!1,Context.email_discovery_mode=!0),Tiles.showOtherOption(),$("#login_user_chooser").hide(),Context.back_action_stack.ClearCancelActions(),$("#cred_cancel_button").hide(),u!=null&&u.indexOf(n)>=0&&Util.eraseCookie(Constants.PREFILL_USER_COOKIE);return}f=Constants.SAVED_USER_COOKIE_INFO_DELIMITER,r="",$.each(i,function(n,t){n&&(r+=Constants.SAVED_USER_COOKIE_USER_DELIMITER),r+=t[0]+f+t[1]+f+t[2]}),Util.setCookie(Constants.SAVED_USER_COOKIE,r,30),Util.eraseCookie(Constants.PREFILL_USER_COOKIE),location.reload()},ApplyToEachSavedUsers:function(n){var t=Util.getCookie(Constants.SAVED_USER_COOKIE),i=Constants.SAVED_USER_COOKIE_USER_DELIMITER,r=Constants.SAVED_USER_COOKIE_INFO_DELIMITER;t!=undefined&&t!=null&&t!=""&&$.each(t.split(i),function(t,i){if(i!=undefined&&i!=null&&i!=""){var u=i.split(r);u.length==3&&u[0].length!=0&&n(u)}})},getUser:function(n,t,i){n=n.toLowerCase();var r=null;return $.each(Tiles.users,function(u,f){(f.login.toLowerCase()==n&&(f.isLive===t||f.domainHint===i)||f.sessionID==n)&&(r=f)}),r},forgetRememberedUser:function(n){var t=$(this).parent().attr("data-session-id");Support.isDefined(t)?$.ajax({headers:{Accept:"application/json"},url:"/forgetuser",dataType:"json",data:{sessionId:encodeURI(t)},success:function(n){Tiles.UpdateUsers(n)},error:function(n,t,i){Support.showClientError(i)},timeout:2e3}):Util.debug_console("sessionId is not defined"),n.preventDefault()},indexOfPropValue:function(n,t,i){for(var r=0;r<n.length;r++)if(n[r][t]==i)return r;return-1},mergeUsers:function(n,t){for(n=n.slice(0),t=t.slice(0),i=0;i<n.length;i++){var u=n[i],r=Tiles.indexOfPropValue(t,"login",u.login);if(r>-1&&(u.isSigned||(n[i]=t[r]),t.splice(r,1),t.length==0))break}return n.concat(t)},redirectToManage:function(){var t=$(this).parent().attr("data-session-id"),i=$(this).attr("data-ref"),r=$("#"+i+"-dropdown"),n;r.hide(),$("#login_user_chooser table").hide(),$(".login_cta_container").css("visibility","visible"),$("#login_cta_text").show(),$("#tiles_cta_text").hide(),n=Tiles.getUser(t),Tiles.updateFirstUserTile(n.login,n.isLive,n.domainHint),$("#login_user_chooser table:first").show(),Context.redirect_to_manage=!0,n.isSigned?window.location.href=n.isLive||n.domainHint==="msa"?"@Html.Raw(CloudStsSettings.ManageMicrosoftAccountProfileUri)":"@Html.Raw(CloudStsSettings.ManageUserProfileUri)":n.authUrl==""?Tiles.showManagedTileUser(n):(n.authUrl+="&LoginOptions=1"+($("#cred_keep_me_signed_in_checkbox").attr("checked")?"1":"0"),Tiles.showFederatedTileUser(n)),Context.back_action_stack.AddAction(Constants.CancelAction.FROM_SHOW_USER_TO_TILES),Tiles.tile_showing_user_cred=!0},UpdateUsers:function(n){Tiles.sso_users&&(n=Tiles.mergeUsers(n,Tiles.sso_users)),Constants.IS_USE_OTHER_ACCOUNT_VISIBLE&&n.push(Tiles.otherJSON),Tiles.users=users=n,$("#login_user_chooser").html(""),Tiles.drawUsers()},signoutAndForgetUser:function(n){var t=$(this).parent().attr("data-session-id"),i=n.data.shouldForgetUser,r=$("#title3_"+t);Support.isDefined(t)?(r.text(Constants.SIGNINGOUT),$(this).append('<iframe name="logoutFrame" src="/uxlogout?sessionId={0}&shouldForgetUser={1}" style="display: none"><\/iframe>'.format(t,i))):Util.debug_console("seesionId is not defined"),n.preventDefault()},updateFirstUserTile:function(n,t,i){var r,u;$("input#cred_userid_inputtext").val(n),$("#login_user_chooser").html(""),r=Tiles.getUser(n,t,i),image_path=Tiles.getUserImage(r),u=Tiles.drawTile(r,image_path,!0),$("#"+u).focus()},isUseOtherAccountVisible:function(){return Tiles.users!=null&&Tiles.users.length!==0&&(Tiles.users.length!==1||Tiles.users[0].link!=="other")&&Constants.IS_USE_OTHER_ACCOUNT_VISIBLE},getUserImage:function(n){return image_path="work_account.png",image_path=n.domainHint&&!Constants.IS_CXH_REQUEST?$.inArray(n.domainHint,["amazon","facebook","google","instagram","linkedin","msa","qq","renren","twitter","weibo","yahoo"])!=-1?n.domainHint+"_80.png":"use_another_account.png":n.link==="other"?"use_another_account.png":n.isLive?"personal_account.png":"work_account.png",Constants.CDN_IMAGE_PATH+image_path},generateUserTileHtml:function(n,t,i,r,u,f,e,o,s,h){var l="",c;return s!=null&&(l='            <div class="smallertext tile_third_name windows_tile_text text-caption2 {0}" style="cursor: pointer" id="title3_{1}">                {2}            <\/div>'.format(n,t,s)),c="",h!=null&&(c=('        <td class="dots">            <div id="{0}_menulink" tabindex="1" data-ref="{2}" data-session-id="{1}" title="'+Constants.CLICKFORMORE+'" aria-label="'+Constants.CLICKFORMORE+'">                &bull;&bull;&bull;            <\/div>        <\/td>').format(n,t,h)),('<table id="{0}" data-session-id="{1}" class="user_tile">    <tr class="{0} {1}" style="cursor: pointer">        <td>            <img class="ad_glyph {0}" src="{2}" alt="{3}" />        <\/td>        <td class="tile_name">            <div class="bigtext tile_primary_name windows_tile_text {0}" style="cursor: pointer" {5}>                {4}            <\/div>            <div class="smallertext tile_secondary_name windows_tile_text text-caption2 {0}" style="cursor: pointer" {7}>                {6}            <\/div>'+l+"        <\/td>"+c+"    <\/tr><\/table>").format(n,t,i,r,u,f?'title="'+f+'"':"",e,o?'title="'+o+'"':"")}},Tiles=MSLogin.Tiles,MSLogin.Util={PrefetchContent:function(n){$("#login_prefetch_container").append($("<iframe/>").attr("src",n).attr("seamless","seamless").attr("scrolling","no").attr("id","login_prefetch_iframe").load(function(){Instrument.prefetch_load_time=new Date-Instrument.prefetch_start,Instrument.prefetch_done=!0}))},PrefetchThreatMetrixContent:function(n){$("#footer_links_container").append($("<iframe/>").attr("src",n).attr("style","color:rgb(0,0,0); float:left; position:absolute; top:-200px; left:-200x; border:0px").attr("height","0px").attr("width","0px").attr("tabindex","-1").attr("id","login_threatmetrix_iframe"))},getCookie:function(n){for(var r,u,i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r==n)return unescape(u)},setCookie:function(n,t,i){var r=new Date;r.setDate(r.getDate()+i);var u=document.location.hostname.split("."),f=u.length,e=t+(i==null?"":";domain=."+u[f-2]+"."+u[f-1]+";path=/; expires="+r.toUTCString());document.cookie=n+"="+e},eraseCookie:function(n){var i=document.location.hostname.split("."),r=i.length,t=n+"= ;domain=."+i[r-2]+"."+i[r-1]+";path=/;expires=Thu, 30-Oct-1980 00:00:01 GMT;";Util.debug_console(t),document.cookie=t,t=n+"= ;domain=."+document.location.hostname+";path=/;expires=Thu, 30-Oct-1980 00:00:01 GMT;",Util.debug_console(t),document.cookie=t},exists:function(n){return n?!0:n==0||n==!1||n==""},valOrDefault:function(n,t){return Util.exists(n)?n:t},debug_console:function(){},ExtractToken:function(n,t,i,r,u){var e,f,o;return(i=Util.valOrDefault(i,"&"),r=Util.valOrDefault(r,"="),e=Util.valOrDefault(u,null),!n)?e:(f=n.indexOf(t+r),0==f?f+=t.length+1:0<f&&(f=n.indexOf(i+t+r),0<f&&(f+=i.length+t.length+1)),-1!=f&&(o=n.indexOf(i,f),-1==o&&(o=n.length),e=n.substring(f,o)),e)},ExtractQSParam:function(n){var t=Context.query_search_params.toLowerCase();return t&&(t=t.substr(1)),Util.ExtractToken(t,n.toLowerCase(),"&","=","")},AddQSParamIfNotExists:function(n,t,i){var e="[?&]"+t+"=([^&]+?)($|&)",o=new RegExp(e,"i"),s=n.match(o),u,f,r;return s||(u="([?&])"+t+"=?(&|$)",f=new RegExp(u,"i"),n=n.replace(f,"$1"),r=Util.ExtractQSParam(t),r&&(!i||i.test(r))&&(n.indexOf("?")==-1?n+="?":n.indexOf("?")<n.length-1&&(n+="&"),n+=t+"="+r)),n},isMSA:function(n){return n.indexOf("login.live.com")!=-1||n.indexOf("login.live-int.com")!=-1||n.indexOf("login.microsoft.com")!=-1?!0:!1},updateRedirectionMessage:function(n){var t=Constants.REDIRECT_MESSAGES.AAD;Util.isMSA(n)&&(t=Constants.REDIRECT_MESSAGES.MSA),$("#redirect_message_text").html(t)},now:function(){var n=window.performance||{};return n.now=function(){return n.now||n.webkitNow||n.msNow||n.oNow||n.mozNow||function(){return(new Date).getTime()}}(),n.now()},StartLocalAccountCxhFlow:function(){try{var n=new CloudExperienceHost.Bridge;return n.fireEvent(CloudExperienceHost.Events.loadIdentityProvider,CloudExperienceHost.SignInIdentityProviders.Local),!1}catch(t){}return!0},CancelCxhFlow:function(){try{var n=new CloudExperienceHost.Bridge;return n.fireEvent(CloudExperienceHost.Events.done,CloudExperienceHost.AppResult.cancel),!1}catch(t){}return!0},NavigateCxh:function(n){try{var t=new CloudExperienceHost.Bridge;return t.fireEvent(CloudExperienceHost.Events.navigate,n),!1}catch(i){}return!0},LogCxhTelemetry:function(n,t){try{var i=new CloudExperienceHost.Bridge;t==undefined?i.invoke("CloudExperienceHost.Telemetry.logEvent",n):i.invoke("CloudExperienceHost.Telemetry.logEvent",n,t)}catch(r){}}},Util=MSLogin.Util,String.prototype.areEqualIgnoreCase=function(n){var t=this;return t.toLowerCase()===n.toLowerCase()?!0:!1},String.prototype.format=function(){for(var t=this,n=0;n<arguments.length;n++)t=t.replace(new RegExp("\\{"+n+"\\}","gm"),arguments[n]);return t},String.prototype.qs=function(n,t){var i=new RegExp("([?&])"+n+"=([^&#]*)","i"),r;return t?this.match(i)?this.replace(i,"$1"+n+"="+t):this.indexOf("?")>0?this+"&"+n+"="+t:this+"?"+n+"="+t:(r=i.exec(this))==null?"":r[2]},MSLogin.WindowsBrowserSso={STATE:{START:"start",INPROGRESS:"in-progress",END:"end",END_SSO:"end-sso",END_USERS:"end-users"},Initialize:function(n){this.options=n||{forceTiles:!1,overallTimeoutMs:4e3},this.options.initiatePullTimeoutMs=this.options.initiatePullTimeoutMs||this.options.overallTimeoutMs,this.options.initiatePullTimeoutAction=this.options.initiatePullTimeoutAction||"abort",this.bsso=Util.ExtractQSParam("bsso").toLowerCase()},LoginWindowsUser:function(n){if(!window.navigator||!$.isFunction(window.navigator.msLaunchUri)||this.bsso=="disable"){this.updateStatus(this.STATE.START,null),this.updateStatus(this.STATE.END,this.bsso=="disable"?"Browser SSO is disabled":"window.navigator.msLaunchUri is not available");return}var t=this;$.when($.Deferred(function(i){t.updateStatus(t.STATE.START,"Initiating cookie pull"),window.navigator.msLaunchUri(n,function(){i.resolve(),t.updateStatus(t.STATE.INPROGRESS,"Windows user login initiated successfully")},function(){i.reject(),t.updateStatus(t.STATE.END,"Windows user login NOT initiated successfully")})})).then(function(){var n,i=setInterval(function(){Util.getCookie("ESTSSSO")&&(clearInterval(i),clearTimeout(n),t.reloadPage())},100);n=setTimeout(function(){clearInterval(i),t.updateStatus(t.STATE.END,"Windows user login timed out waiting for SSO cookie.")},t.options.overallTimeoutMs)})},PullBrowserSsoCookie:function(){if(!window.navigator||!$.isFunction(window.navigator.msLaunchUri)||this.bsso=="disable"){this.updateStatus(this.STATE.START,null),this.updateStatus(this.STATE.END,this.bsso=="disable"?"Browser SSO is disabled":"window.navigator.msLaunchUri is not available");return}var n=this,t="tbauth://login.windows.net?context="+encodeURIComponent(window.location.href);$.when($.Deferred(function(i){var r,f,u;n.updateStatus(n.STATE.START,"Initiating cookie pull"),r=t,(Util.getCookie("ESTSSSOTILES")||n.options.forceTiles)&&(r=r+"&user_id=*",Util.eraseCookie("ESTSSSOTILES")),f=(new Date).getTime(),window.navigator.msLaunchUri(r,function(){clearTimeout(u);var t=(new Date).getTime()-f;i.resolve(),n.updateStatus(n.STATE.INPROGRESS,"Cookie pull initiated successfully (took "+t+" ms)")},function(){clearTimeout(u);var t=(new Date).getTime()-f;i.reject(),n.updateStatus(n.STATE.END,"Cookie pull was NOT initiated successfully (took "+t+" ms)")}),u=setTimeout(function(){clearInterval(u),n.options.initiatePullTimeoutAction=="abort"?(i.reject(),n.updateStatus(n.STATE.END,"Initiating cookie pull timed out.")):(i.resolve(),n.updateStatus(n.STATE.INPROGRESS,"Initiating cookie pull timed out but starting polling anyway in case cookie was pulled."))},n.options.initiatePullTimeoutMs)})).then(function(){var u=(new Date).getTime(),i,r=setInterval(function(){var u=Util.getCookie("ESTSUSERLIST");u?(clearInterval(r),clearTimeout(i),n.updateStatus(n.STATE.INPROGRESS,"Users list cookie detected"),Util.eraseCookie("ESTSUSERLIST"),n.processUsersList(u,t)):Util.getCookie("ESTSSSO")&&(clearInterval(r),clearTimeout(i),n.reloadPage())},250);i=setTimeout(function(){clearInterval(r),n.updateStatus(n.STATE.END,"Pull cookie timed out.")},n.options.overallTimeoutMs)})},reloadPage:function(){this.bsso=="debug"?(this.updateStatus(this.STATE.END_SSO,"SSO cookie detected. Refreshing page in 5 seconds (due to debug mode)."),setTimeout(function(){window.location.href.toLowerCase().indexOf("prompt=select_account")==-1?window.location.reload(!0):window.location.replace(window.location.href.replace(/prompt=[^&]*/i,""))},5e3)):(this.updateStatus(this.STATE.END_SSO,"SSO cookie detected. Refreshing page."),window.location.href.toLowerCase().indexOf("prompt=select_account")==-1?window.location.reload(!0):window.location.replace(window.location.href.replace(/prompt=[^&]*/i,"")))},processUsersList:function(n,t){try{if(Tiles.users||(Tiles.users=[]),Tiles.sso_users=[],$.each($.parseJSON(n).users,function(n,i){var r={name:i.display_name||"",login:i.upn,imageAAD:"ad_glyph.png",imageMSA:"ad_glyph.png",isLive:!1,isWindows:!0,isSigned:!0,link:t+"&user_id="+encodeURIComponent(i.unique_id),authUrl:"",sessionID:"",domainHint:""};Tiles.sso_users.push(r)}),Tiles.sso_users.length>0){var i=Context.email_discovery_mode;Context.email_discovery_mode=!1,Constants.IS_USE_OTHER_ACCOUNT_VISIBLE&&Tiles.users.splice(Tiles.users.length-1,1),Tiles.UpdateUsers(Tiles.users),Context.email_discovery_mode=i,this.updateStatus(this.STATE.END_USERS,"User list processed.")}else this.updateStatus(this.STATE.END,"User list is empty.")}catch(r){this.updateStatus(this.STATE.END,"WindowsBrowserSso.processUsersList: exception: "+r)}},updateStatus:function(n,t){this.options.statusCallback&&$.isFunction(this.options.statusCallback)&&this.options.statusCallback({state:n,message:t})}},WindowsBrowserSso=MSLogin.WindowsBrowserSso